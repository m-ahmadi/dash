{"version":3,"sources":["../../../src/js/content/mediator.js"],"names":["define","conf","token","uk","wizard","confirm","process","login","widget","inst","u","extend","newPubSub","ROOT","temp","Handlebars","templates","MSG","widgets","_WIDGETS_","els","processNote","ori","counter","isStatWrong","n","fetchAllFail","doing","log","setTimeout","fetchAll","timer","open","$","ajax","url","BASE","method","dataType","header","done","isEmptyObj","data","finish","len","objLength","step","get","sorted","Object","keys","forEach","inc","push","k","order","sort","w","i","id","create","close","fail","x","status","start","resume","always","save","contentType","JSON","stringify","onLoginErr","cb","css","el","prop","isStr","parseInt","slice","adjustHeight","root","h","avail","window","innerHeight","addCustomEvt","on","e","fn","note","error","update","remove","find","each","l","d","expand","min","undefined","s","action","key","val","sortable","edit","init","getEls","items","handle","delay","opacity","distance","revert","scroll","tolerance","add","children","length","deleteAll","minAll","maxAll","max","shrinkAll","shrink","expandAll","ws"],"mappings":"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","file":"mediator.js","sourcesContent":["define([\r\n\t\"config\",\r\n\t\"token\",\r\n\t\"uk\",\r\n\t\"./wizard\",\r\n\t\"./confirm\",\r\n\t\"./process\",\r\n\t\"./login\",\r\n\t\"./widget/widget\"\r\n], (\r\n\tconf,\r\n\ttoken,\r\n\tuk,\r\n\twizard,\r\n\tconfirm,\r\n\tprocess,\r\n\tlogin,\r\n\twidget\r\n) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst ROOT = \"[data-root='content']\";\r\n\tconst temp = Handlebars.templates;\r\n\tconst MSG = [\r\n\t\t\"Processing your request...\",\r\n\t\t\"Fetching your widgets...\"\r\n\t];\r\n\tlet widgets = {};\r\n\tlet _WIDGETS_ = {};\r\n\tlet els, processNote;\r\n\t\r\n\t/* function viewport() {\r\n\t\tconst w = window.innerWidth;\r\n\t\treturn w > 0     && w < 640   ? 0 :\r\n\t\t\t   w >= 640  && w <= 960  ? 0 :\r\n\t\t\t   w >= 960  && w <= 1200 ? 1 :\r\n\t\t\t   w >= 1200 && w <= 1600 ? 2 :\r\n\t\t\t   w >= 1600 ? 3 : false;\r\n\t} */\r\n\t\r\n\tconst ori = [\"\", \"st\",\"nd\",\"rd\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\"];\r\n\t\r\n\tlet counter = 1;\r\n\t\r\n\t\r\n\tfunction isStatWrong(n) {\r\n\t\treturn n && (n === 403 || n === 404) ? true : false;\r\n\t}\r\n\tfunction fetchAllFail() {\r\n\t\tif (counter > 1) {\r\n\t\t\tprocess.doing(` (${counter}${ori[counter]} attempt)`, true);\r\n\t\t}\r\n\t\tcounter += 1;\r\n\t\tprocess.log(\"Fetching widget list failed.\", \"danger\");\r\n\t\tif (counter > 3) {\r\n\t\t\tprocess.log(\"Aborted.\", \"danger\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetTimeout(fetchAll, 1000);\r\n\t}\r\n\tfunction fetchAll() {\r\n\t\tlet timer;\r\n\t\tif (counter === 1) {\r\n\t\t\tprocess.open();\r\n\t\t}\r\n\t\tprocess.doing(\"Fetching widget list.\");\r\n\t\t$.ajax({\r\n\t\t\turl: conf.BASE + \"dashboard/load\" + token(), // \"widget/fetch\",\r\n\t\t\tmethod: \"GET\",\r\n\t\t\tdataType: \"json\",\r\n\t\t\theader: {\"cache-control\": \"no-cache\"}\r\n\t\t})\r\n\t\t.done( data => {\r\n\t\t\tif ( u.isEmptyObj(data) ) {\r\n\t\t\t\tprocess.finish();\r\n\t\t\t\tprocess.log(\"No widgets to fetch\", \"primary\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t_WIDGETS_ = data;\r\n\t\t\tconst len = u.objLength(data);\r\n\t\t\tprocess.log(`Found ${len} widgets.`, \"success\");\r\n\t\t\tprocess.doing(\"Creating widgets.\");\r\n\t\t\t\r\n\t\t\tlet step = 100 - process.get() / len;\r\n\t\t\tlet sorted = [];\r\n\t\t\tObject.keys(data).forEach(k => {\r\n\t\t\t\tprocess.inc(2);\r\n\t\t\t\tsorted.push([data[k].order, k]);\r\n\t\t\t});\r\n\t\t\tsorted.sort();\r\n\t\t\tsorted.forEach(i => {\r\n\t\t\t\tlet w = data[ i[1] ];\r\n\t\t\t\tprocess.inc(step);\r\n\t\t\t\twidgets[w.id] = widget.create(els.widgets, w);\r\n\t\t\t});\r\n\t\t\tprocess.log(\"Finished.\", \"success\");\r\n\t\t\tprocess.close();\r\n\t\t})\r\n\t\t.fail(x => {\r\n\t\t\tif ( isStatWrong(x.status) ) {\r\n\t\t\t\tlogin.start(() => {\r\n\t\t\t\t\tprocess.resume();\r\n\t\t\t\t\tfetchAllFail();\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tfetchAllFail();\r\n\t\t\t}\r\n\t\t})\r\n\t\t.always();\r\n\t}\r\n\tfunction save(done, fail, always) {\r\n\t\t$.ajax({\r\n\t\t\turl: conf.BASE + \"dashboard/save\" + token(), // \"widget/add\",\r\n\t\t\tmethod: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: JSON.stringify(_WIDGETS_)\r\n\t\t})\r\n\t\t.done(done)\r\n\t\t.fail( x => isStatWrong(x.status) ? login.start(fail) : fail() )\r\n\t\t.always(always);\r\n\t}\r\n\tfunction onLoginErr(cb) {\r\n\t\tlogin.start(cb);\r\n\t}\r\n\tfunction css(el, prop) {\r\n\t\tel = u.isStr(el) ? $(el) : el;\r\n\t\treturn parseInt( el.css(prop).slice(0, -2), 10 );\r\n\t}\r\n\tfunction adjustHeight() {\r\n\t\tlet el = els.root;\r\n\t\tlet h = css(el, \"min-height\");\r\n\t\tlet avail = window.innerHeight - ( css(\"#heading\", \"height\") + css(\"#footer\", \"height\") );\r\n\t\tel.css(\"min-height\", avail);\r\n\t}\r\n\tfunction addCustomEvt() {\r\n\t\twizard.on(\"submit:create\", (e, fn) => {\r\n\t\t\tprocessNote = uk.note.process(MSG[0], 0, \"top-center\");\r\n\t\t\t_WIDGETS_[e.id] = e;\r\n\t\t\tsave(() => {\r\n\t\t\t\twidgets[e.id] = widget.create(els.widgets, e);\r\n\t\t\t\tfn(true);\r\n\t\t\t\tprocessNote.close();\r\n\t\t\t}, () => {\r\n\t\t\t\tfn(false);\r\n\t\t\t\tprocessNote.close();\r\n\t\t\t\tuk.note.error(\"Could not create your widget. Try again.\");\r\n\t\t\t});\r\n\t\t});\r\n\t\twizard.on(\"submit:edit\", (e, fn) => {\r\n\t\t\tprocessNote = uk.note.process(MSG[0], 0, \"top-center\");\r\n\t\t\t_WIDGETS_[e.id] = e;\r\n\t\t\tsave(() => {\r\n\t\t\t\twidgets[e.id].update(e);\r\n\t\t\t\tfn(true);\r\n\t\t\t\tprocessNote.close();\r\n\t\t\t}, () => {\r\n\t\t\t\tfn(false);\r\n\t\t\t\tprocessNote.close();\r\n\t\t\t\tuk.note.error(\"Could not create your widget. Try again.\");\r\n\t\t\t});\r\n\t\t});\r\n\t\tconfirm.on(\"submit\", (id, fn) => {\r\n\t\t\tlet cb;\r\n\t\t\tprocessNote = uk.note.process(MSG[0], 0, \"top-center\");\r\n\t\t\t\r\n\t\t\tif (id === \"delete_all\") {\r\n\t\t\t\t_WIDGETS_ = {};\r\n\t\t\t\tcb = () => {\r\n\t\t\t\t\tObject.keys(widgets).forEach(k => widgets[k].remove());\r\n\t\t\t\t\twidgets = {};\r\n\t\t\t\t};\r\n\t\t\t} else if (id === \"save_all\") {\r\n\t\t\t\t\r\n\t\t\t\tels.widgets.find(\"> div\").each((i, l) => {\r\n\t\t\t\t\tlet d = $(l).data();\r\n\t\t\t\t\t_WIDGETS_[d.id].order = i;\r\n\t\t\t\t\t_WIDGETS_[d.id].expand = parseInt(d.expand);\r\n\t\t\t\t\t_WIDGETS_[d.id].min = d.min;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdelete _WIDGETS_[id];\r\n\t\t\t\tcb = () => {\r\n\t\t\t\t\twidgets[id].remove();\r\n\t\t\t\t\tdelete widgets[id];\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsave(() => {\r\n\t\t\t\tcb ? cb() : undefined;\r\n\t\t\t\tprocessNote.close();\r\n\t\t\t\tfn();\r\n\t\t\t}, () => {\r\n\t\t\t\tfn();\r\n\t\t\t\tuk.note.error(\"Couldn't remove the widget.\");\r\n\t\t\t\tprocessNote.close();\r\n\t\t\t});\r\n\t\t});\r\n\t\twizard.on(\"login_error\", onLoginErr);\r\n\t\twidget.on(\"login_error\", onLoginErr);\r\n\t\twidget.on(\"save_signal\", e => {\r\n\t\t\tlet s = e.action;\r\n\t\t\tif (s === \"create\") {\r\n\t\t\t\t\r\n\t\t\t} else if (s === \"edit\") {\r\n\t\t\t\r\n\t\t\t\t_WIDGETS_[e.id][e.key] = e.val;\r\n\t\t\t\t\r\n\t\t\t} else if (s === \"delete\") {\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsave(e.done, e.fail);\r\n\t\t});\r\n\t\twidget.on(\"create_node\", (id, widget)=> {\r\n\t\t\twidgets[id] = widget;\r\n\t\t\tels.widgets.sortable(\"refresh\");\r\n\t\t});\r\n\t\twidget.on(\"delete\", id => {\r\n\t\t\tconfirm.open(id);\r\n\t\t});\r\n\t\twidget.on(\"edit\", e => {\r\n\t\t\twizard.edit(e);\r\n\t\t});\r\n\t}\r\n\tinst.init = () => {\r\n\t\tels = u.getEls(ROOT);\r\n\t\t\r\n\t\tadjustHeight();\r\n\t\t$(window).on(\"resize\", adjustHeight);\r\n\t\tels.widgets.sortable({\r\n\t\t\titems: \"> div\",\r\n\t\t\thandle: \".uk-sortable-handle\",\r\n\t\t\tdelay: 50,\r\n\t\t\topacity: 0.5,\r\n\t\t\tdistance: 5,\r\n\t\t\trevert: 300, // true\r\n\t\t\tscroll: false,\r\n\t\t\ttolerance: \"pointer\"\r\n\t\t//\tplaceholder: \"ui-state-highlight\"\r\n\t\t});\r\n\t\t\r\n\t\tels.add.on(\"click\", () => {\r\n\t\t\twizard.start( els.widgets.children().length );\r\n\t\t});\r\n\t\tels.deleteAll.on(\"click\", () => {\r\n\t\t\tconfirm.open(\"delete_all\");\r\n\t\t});\r\n\t\tels.save.on(\"click\", () => {\r\n\t\t\tconfirm.open(\"save_all\");\r\n\t\t});\r\n\t\tels.minAll.on(\"click\", () => {\r\n\t\t\tObject.keys(widgets).forEach( k => widgets[k].min() );\r\n\t\t});\r\n\t\tels.maxAll.on(\"click\", () => {\r\n\t\t\tObject.keys(widgets).forEach( k => widgets[k].max() );\r\n\t\t});\r\n\t\tels.shrinkAll.on(\"click\", () => {\r\n\t\t\tObject.keys(widgets).forEach( k => widgets[k].shrink() );\r\n\t\t});\r\n\t\tels.expandAll.on(\"click\", () => {\r\n\t\t\tObject.keys(widgets).forEach( k => widgets[k].expand() );\r\n\t\t});\r\n\t\t\r\n\t\t$(window).on(\"beforeunload\", e => {\r\n\t\t\tif (false) { // changed then return\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\t\t\r\n\t\twizard.init();\r\n\t\tconfirm.init();\r\n\t\tprocess.init();\r\n\t\tlogin.init();\r\n\t\taddCustomEvt();\r\n\t\twidget.init();\r\n\t\t\r\n\t\tif ( !token(true) ) {\r\n\t\t\tlogin.start(fetchAll);\r\n\t\t} else {\r\n\t\t\tfetchAll();\r\n\t\t}\r\n\t};\r\n\t\r\n\twindow.ws = () => {return widgets};\r\n\treturn inst;\r\n});"]}
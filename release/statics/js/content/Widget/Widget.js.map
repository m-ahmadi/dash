{"version":3,"sources":["../../../../src/js/content/Widget/Widget.js"],"names":["define","conf","token","makeLineChart","manager","u","extend","newPubSub","temp","Handlebars","templates","extractor","BODY","KLASS_X1","join","KLASS_X2","KLASS_X3","KLASSES","DATE_FORMAT","jsonStr","JSON","stringify","jsonParse","parse","worker","init","Worker","ROOT","onmessage","d","e","data","emit","reqId","result","getDate","type","count","moment","subtract","format","getSensors","o","a","Object","keys","forEach","p","i","push","id","unit","generateSeries","sensors","res","sensor","name","color","tooltip","valueDecimals","container","title","Highcharts","stockChart","rangeSelector","exporting","credits","align","text","style","fontSize","chart","zoomType","legend","enabled","series","editLineChart","update","makeTitle","createPanel","parent","rangeTitle","expand","min","body","ctx","xOne","xTwo","xThree","html","panel","append","children","last","constructor","inst","w","root","els","TypeError","el","menus","find","btnMax","is","slideUp","undefined","max","btnMin","slideDown","setSize","curr","parseInt","attr","inced","n","removeClass","toAdd","addClass","shrink","deced","mark","stat","keep","par","spinnerParent","markSuccess","markFail","setTimeout","spinnerOn","spinner","spinnerOff","loadGraphSensorData","showLoading","$","ajax","url","BASE","method","start_date","rangeType","rangeCount","end_date","device_ids","device","service_ids","service","kpis","done","postMessage","rawData","length","hideLoading","fail","x","status","always","refresh","disabled","load","getEls","on","action","target","currentTarget","remove","menuBtn","mouseout","edit","destroy","obj","window","asad","create"],"mappings":"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","file":"Widget.js","sourcesContent":["define([\r\n\t\"config\",\r\n\t\"token\",\r\n\t\"./makeLineChart\",\r\n], (conf, token, makeLineChart) => {\r\n\tconst manager = u.extend( newPubSub() );\r\n\tconst temp = Handlebars.templates;\r\n\tconst extractor = newPubSub();\r\n\t\r\n\tconst BODY = \"[data-container]\";\r\n\tconst KLASS_X1 = [\r\n\t\t\"uk-width-1-1@s\",\r\n\t\t\"uk-width-1-1@m\",\r\n\t\t\"uk-width-1-2@l\",\r\n\t\t\"uk-width-1-2@xl\"\r\n\t].join(\" \");\r\n\tconst KLASS_X2 = [\r\n\t\t\"uk-width-1-1@s\",\r\n\t\t\"uk-width-1-1@m\",\r\n\t\t\"uk-width-2-3@l\",\r\n\t\t\"uk-width-3-4@xl\"\r\n\t].join(\" \");\r\n\tconst KLASS_X3 = \"uk-width-1-1\";\r\n\tconst KLASSES = `${KLASS_X1} ${KLASS_X2} ${KLASS_X3}`;\r\n\t\r\n\tconst DATE_FORMAT = \"Y/MM/DD HH:mm\";\r\n\tconst jsonStr = JSON.stringify;\r\n\tconst jsonParse = JSON.parse;\r\n\tlet worker;\r\n\t\r\n\t\r\n\tfunction init() {\r\n\t\tworker = new Worker(conf.ROOT + \"js/content/Widget/worker.js\");\r\n\t\tworker.onmessage = e => {\r\n\t\t\tlet d = e.data;\r\n\t\t\textractor.emit(d.reqId, d.result);\r\n\t\t};\r\n\t}\r\n\t\r\n\tfunction getDate(type, count) {\r\n\t\tif (type && count) {\r\n\t\t\treturn moment().subtract(count, type).format(DATE_FORMAT);\r\n\t\t} else {\r\n\t\t\treturn moment().format(DATE_FORMAT);\r\n\t\t}\r\n\t}\r\n\tfunction getSensors(o) {\r\n\t\tlet a = [];\r\n\t\tObject.keys(o).forEach(i => {\r\n\t\t\tlet p = o[i];\r\n\t\t\ta.push({\r\n\t\t\t\tid: p.id,\r\n\t\t\t\tunit: p.unit\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn a;\r\n\t}\r\n\tfunction generateSeries(sensors) {\r\n\t\tlet res = [];\r\n\t\tObject.keys(sensors).forEach(i => {\r\n\t\t\tlet sensor = sensors[i];\r\n\t\t\tres.push({\r\n\t\t\t\ttype: \"line\",\r\n\t\t\t\tname: sensor.name,\r\n\t\t\t\tcolor: \"#\"+ sensor.color,\r\n\t\t\t\tdata: [],\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tvalueDecimals: 2\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n\tfunction makeLineChart(container, title, sensors) {\r\n\t\treturn Highcharts.stockChart(container[0], {\r\n\t\t\trangeSelector: false,\r\n\t\t\texporting: false,\r\n\t\t\tcredits: false,\r\n\t\t\ttitle: {\r\n\t\t\t\talign: \"left\",\r\n\t\t\t\ttext: title || \"\",\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\tcolor: \"#717171\",\r\n\t\t\t\t\tfontSize: \"14px\"\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tchart: {\r\n\t\t\t\tzoomType: \"x\"\r\n\t\t\t},\r\n\t\t\tlegend: {\r\n\t\t\t\tenabled: true\r\n            },\r\n\t\t\tseries: generateSeries(sensors)\r\n\t\t});\r\n\t}\r\n\tfunction editLineChart(chart, title, sensors) {\r\n\t\tchart.update({\r\n\t\t\ttitle: {\r\n\t\t\t\ttext: title\r\n\t\t\t},\r\n\t\t\tseries: generateSeries(sensors)\r\n\t\t});\r\n\t}\r\n\tfunction makeTitle(type) {\r\n\t\tlet title;\r\n\t\tswitch (type) {\r\n\t\t\tcase 0: title = \"Graph Sensor\";           break;\r\n\t\t\tcase 1: title = \"Sensor Violation Ratio\"; break;\r\n\t\t\tcase 2: title = \"Sensor Violation Stats\"; break;\r\n\t\t\tcase 3: title = \"Map\";                    break;\r\n\t\t}\r\n\t\treturn title;\r\n\t}\r\n\tfunction createPanel(parent, type, rangeTitle, id, expand, min) {\r\n\t\tlet body;\r\n\t\tconst ctx = {\r\n\t\t\ttitle: makeTitle(type),\r\n\t\t\trangeTitle: rangeTitle,\r\n\t\t\tbody: body,\r\n\t\t\tid: id,\r\n\t\t\txOne: expand === 1,\r\n\t\t\txTwo: expand === 2,\r\n\t\t\txThree: expand === 3,\r\n\t\t\tmin: min\r\n\t\t};\r\n\t\tconst html = temp.panel(ctx);\r\n\t\tparent.append(html);\r\n\t\treturn parent.children().last();\r\n\t}\r\n\t\r\n\tfunction constructor(container, o) {\r\n\t\tconst inst = {};\r\n\t\tlet w = {},\r\n\t\t\troot, els,\r\n\t\t\tchart = {};\r\n\t\t\r\n\t\tif (!container || !o) {\r\n\t\t\tthrow new TypeError(\"You must provide a container and a widget object.\");\r\n\t\t}\r\n\t\tw = o;\r\n\t\t\r\n\t\t\r\n\t\tfunction min() {\r\n\t\t\tlet el = els.body;\r\n\t\t\troot.data(\"min\", true);\r\n\t\t\tels.menus.find(\"[data-resize]\").html( temp.btnMax() );\r\n\t\t\t\r\n\t\t\t!el.is(\":animated\") ? el.slideUp(400, () => {\r\n\t\t\t\t//if (chart) chart.setSize();\r\n\t\t\t}) : undefined;\r\n\t\t}\r\n\t\tfunction max() {\r\n\t\t\tlet el = els.body;\r\n\t\t\troot.data(\"min\", false);\r\n\t\t\tels.menus.find(\"[data-resize]\").html( temp.btnMin() );\r\n\t\t\t\r\n\t\t\t!el.is(\":animated\") ? el.slideDown(400, () => {\r\n\t\t\t\tif (chart) chart.setSize();\r\n\t\t\t}) : undefined;\r\n\t\t}\r\n\t\tfunction expand() {\r\n\t\t\tlet curr = parseInt(root.attr(\"data-expand\"), 10);\r\n\t\t\tlet inced = curr + 1;\r\n\t\t\tlet n = inced > 3 ? 3 :\r\n\t\t\t\t\tinced < 0 ? 0 : inced;\r\n\t\t\troot.attr(\"data-expand\", n);\r\n\t\t\troot.removeClass(KLASSES);\r\n\t\t\tlet toAdd;\r\n\t\t\tswitch (curr) {\r\n\t\t\t\tcase 0: toAdd = KLASS_X1; break;\r\n\t\t\t\tcase 1: toAdd = KLASS_X2; break;\r\n\t\t\t\tcase 2: toAdd = KLASS_X3; break;\r\n\t\t\t\tcase 3: toAdd = KLASS_X3; break;\r\n\t\t\t}\r\n\t\t\troot.addClass(toAdd);\r\n\t\t\tif (chart) chart.setSize();\r\n\t\t}\r\n\t\tfunction shrink() {\r\n\t\t\tlet curr = parseInt(root.attr(\"data-expand\"), 10);\r\n\t\t\tlet deced = curr - 1;\r\n\t\t\tlet n = deced > 3 ? 3 :\r\n\t\t\t\t\tdeced < 0 ? 0 : deced;\r\n\t\t\troot.attr(\"data-expand\", n);\r\n\t\t\troot.removeClass(KLASSES);\r\n\t\t\tlet toAdd;\r\n\t\t\tswitch (curr) {\r\n\t\t\t\tcase 0: toAdd = \"\"; break;\r\n\t\t\t\tcase 1: toAdd = \"\"; break;\r\n\t\t\t\tcase 2: toAdd = KLASS_X1; break;\r\n\t\t\t\tcase 3: toAdd = KLASS_X2; break;\r\n\t\t\t}\r\n\t\t\troot.addClass(toAdd);\r\n\t\t\tif (chart) chart.setSize();\r\n\t\t}\r\n\t\tfunction mark(stat, keep) {\r\n\t\t\tlet par = els.spinnerParent;\r\n\t\t\tpar.html(\"&nbsp;\");\r\n\t\t\tpar.append( stat ? temp.markSuccess() : temp.markFail() );\r\n\t\t\tif (!keep) {\r\n\t\t\t\tsetTimeout(() => par.html(\"&nbsp;\"), 1200);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction spinnerOn() {\r\n\t\t\tlet par = els.spinnerParent;\r\n\t\t\tpar.html(\"&nbsp;\");\r\n\t\t\tpar.append( temp.spinner() );\r\n\t\t}\r\n\t\tfunction spinnerOff() {\r\n\t\t\tels.spinnerParent.html(\"&nbsp;\");\r\n\t\t}\r\n\t\tfunction loadGraphSensorData() {\r\n\t\t\tspinnerOn();\r\n\t\t\tchart ? chart.showLoading() : undefined;\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: conf.BASE +\"device/devicekpisensordata\"+ token(),\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tstart_date: getDate(w.rangeType, w.rangeCount),\r\n\t\t\t\t\tend_date: getDate(),\r\n\t\t\t\t\tdevice_ids: jsonStr([w.device.id]),\r\n\t\t\t\t\tservice_ids: jsonStr([w.service.id]),\r\n\t\t\t\t\tkpis: jsonStr( getSensors(w.sensors) )\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.done(data => {\r\n\t\t\t\tif (!data) {\r\n\t\t\t\t\tworker.postMessage({reqId: w.id, rawData: []});\r\n\t\t\t\t} else if (data.length) {\r\n\t\t\t\t\tworker.postMessage({reqId: w.id, rawData: data});\r\n\t\t\t\t}\r\n\t\t\t\tspinnerOff();\r\n\t\t\t\tmark(true);\r\n\t\t\t\tchart.hideLoading()\r\n\t\t\t})\r\n\t\t\t.fail(x => {\r\n\t\t\t\tspinnerOff();\r\n\t\t\t\tmark(false, true);\r\n\t\t\t\tchart.hideLoading();\r\n\t\t\t\t// root.children().first().prepend( temp.alert({message: \"Couldn't fetch widget data.\"}) );\r\n\t\t\t\tif (x.status === 403) manager.emit(\"login_error\");\r\n\t\t\t})\r\n\t\t\t.always(() => els.refresh.attr({disabled: false}));\r\n\t\t}\r\n\t\tfunction load() {\r\n\t\t\tswitch (w.type) {\r\n\t\t\t\tcase 0: loadGraphSensorData(w); break;\r\n\t\t\t\tcase 1: ; break;\r\n\t\t\t\tcase 2: ; break;\r\n\t\t\t\tcase 3: ; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction init() {\r\n\t\t\troot = createPanel(container, w.type, w.rangeTitle, w.id, w.expand, w.min);\r\n\t\t\tels = u.getEls(root);\r\n\t\t\t\r\n\t\t\t// when creating dom stuff.\r\n\t\t\t \r\n\t\t\tconst type = w.type;\r\n\t\t\tif (type === 0) {\r\n\t\t\t\tchart = makeLineChart(els.body, w.device.name, w.sensors);\r\n\t\t\t\t\r\n\t\t\t\textractor.on(\"\"+w.id, d => {\r\n\t\t\t\t\td.forEach((i, x) => {\r\n\t\t\t\t\t\tchart.series[x].update({data: i});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\r\n\t\t\t} else if (type === 1) {\r\n\t\t\t\r\n\t\t\t} else if (type === 2) {\r\n\t\t\t\r\n\t\t\t} else if (type === 3) {\r\n\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tels.menus.on(\"click\", \"[data-menu]\", e => {\r\n\t\t\t\tlet action = $(e.target).data().action || $(e.currentTarget).data().action;\r\n\t\t\t\t\taction = parseInt(action, 10);\r\n\t\t\t\tif (action === 0) {\r\n\t\t\t\t\tmax();\r\n\t\t\t\t} else if (action === 1) {\r\n\t\t\t\t\tmin();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tels.expand.on(\"click\", () => {\r\n\t\t\t\texpand();\r\n\t\t\t});\r\n\t\t\tels.shrink.on(\"click\", () => {\r\n\t\t\t\tshrink();\r\n\t\t\t});\r\n\t\t\tels.remove.on(\"click\", () => {\r\n\t\t\t\tels.menuBtn.mouseout();\r\n\t\t\t\tmanager.emit(\"delete\", w.id);\r\n\t\t\t});\r\n\t\t\tels.refresh.on(\"click\", e => {\r\n\t\t\t\t$(e.target).attr({disabled: true});\r\n\t\t\t\tload();\r\n\t\t\t});\r\n\t\t\tels.edit.on(\"click\", () => {\r\n\t\t\t\tels.menuBtn.mouseout();\r\n\t\t\t\t\r\n\t\t\t\tmanager.emit(\"edit\", w)\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tinit();\r\n\t\tload();\r\n\t\t\r\n\t\tinst.chart = chart;\r\n\t\tinst.mark = mark;\r\n\t\tinst.refresh = load;\r\n\t\tinst.min = min;\r\n\t\tinst.max = max;\r\n\t\tinst.expand = expand;\r\n\t\tinst.shrink = shrink;\r\n\t\tinst.remove = () => {\r\n\t\t\troot.remove();\r\n\t\t\tchart ? chart.destroy() : undefined;\r\n\t\t};\r\n\t\tinst.update = obj => {\r\n\t\t\tw = obj;\r\n\t\t\tels.title.text( makeTitle(w.type) );\r\n\t\t\tels.rangeTitle.text( w.rangeTitle );\r\n\t\t\tswitch (w.type) {\r\n\t\t\t//\tcase 0: editLineChart(chart, w.device.name, w.sensors); break;\r\n\t\t\t\tcase 0: chart = makeLineChart(els.body, w.device.name, w.sensors); break;\r\n\t\t\t\tcase 1: ; break;\r\n\t\t\t\tcase 2: ; break;\r\n\t\t\t\tcase 3: ; break;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tload();\r\n\t\t};\r\n\t\t\r\n\t\tmanager.emit(\"create_node\", w.id, inst);\r\n\t\twindow.asad = inst;\r\n\t\treturn inst;\r\n\t}\r\n\t\r\n\tmanager.create = constructor;\r\n\tmanager.init = init;\r\n\t\r\n\treturn manager;\r\n});"]}
{"version":3,"sources":["../../../src/js/login.js"],"names":["define","conf","uk","inst","u","extend","newPubSub","ROOT","temp","getTemps","MIN_USER_CHARS","MIN_PASS_CHARS","ALERT_TIMEOUT","data","username","undefined","password","els","callback","alert","ctx","keep","alerts","append","el","find","setTimeout","click","request","toDisable","attr","disabled","process","type","message","noClose","$","ajax","url","BASE","method","done","empty","success","Cookies","remove","set","d","fail","x","stat","resTxt","responseText","o","JSON","parse","Msg","state","danger","changeSubmitBtn","p","length","submit","keyup","e","target","val","key","min","removeClass","addClass","start","cb","openModal","inpust","add","focus","init","getEls","on","window","login"],"mappings":"AAAAA,OAAO,CAAC,aAAD,EAAgB,SAAhB,CAAP,EAAmC,UAACC,IAAD,EAAOC,EAAP,EAAc;AAChD,KAAMC,OAAOC,EAAEC,MAAF,CAAUC,WAAV,CAAb;AACA,KAAMC,OAAO,qBAAb;AACA,KAAMC,OAAOJ,EAAEK,QAAF,CAAW,QAAX,CAAb;;AAEA,KAAMC,iBAAiB,CAAvB;AACA,KAAMC,iBAAiB,CAAvB;AACA,KAAMC,gBAAgB,IAAtB;;AAGA,KAAMC,OAAO;AACZC,YAAUC,SADE;AAEZC,YAAUD;AAFE,EAAb;AAIA,KAAIE,YAAJ;AAAA,KAASC,iBAAT;;AAGA,UAASC,KAAT,CAAeC,GAAf,EAAoBC,IAApB,EAA0B;AACzB,MAAIC,SAASL,IAAIK,MAAjB;AACAA,SAAOC,MAAP,CAAef,KAAKW,KAAL,CAAWC,GAAX,CAAf;AACA,MAAI,CAACC,IAAL,EAAW;AACV,OAAIG,KAAKF,OAAOG,IAAP,CAAY,kCAAZ,CAAT;AACAC,cAAW;AAAA,WAAMF,GAAGG,KAAH,EAAN;AAAA,IAAX,EAA6Bf,aAA7B;AACA;AACD;AACD,UAASgB,OAAT,GAAmB;AAClBX,MAAIY,SAAJ,CAAcC,IAAd,CAAmB,EAACC,UAAU,IAAX,EAAnB;AACAd,MAAIe,OAAJ,CAAYT,MAAZ,CAAoBf,KAAKW,KAAL,CAAW,EAACc,MAAM,SAAP,EAAkBD,SAAS,IAA3B,EAAiCE,SAAS,4BAA1C,EAAwEC,SAAS,IAAjF,EAAX,CAApB;AACAC,IAAEC,IAAF,CAAO;AACNC,QAAKrC,KAAKsC,IAAL,GAAY,YADX;AAENC,WAAQ,MAFF;AAGN3B,SAAMA;AAHA,GAAP,EAKC4B,IALD,CAKM,aAAK;AACVxB,OAAIe,OAAJ,CAAYU,KAAZ;AACAvB,SAAM,EAACc,MAAM,SAAP,EAAkBU,SAAS,IAA3B,EAAiCT,SAAS,mBAA1C,EAAN,EAAsE,IAAtE;AACAU,WAAQC,MAAR,CAAe,MAAf;AACAD,WAAQE,GAAR,CAAY,MAAZ,EAAoBC,CAApB;AACA7B;AACA,GAXD,EAYC8B,IAZD,CAYM,UAACC,CAAD,EAAIC,IAAJ,EAAa;AAClB,OAAIC,SAASF,EAAEG,YAAf;AACAC,OAAIF,SAASG,KAAKC,KAAL,CAAWN,EAAEG,YAAb,CAAT,GAAsC,EAACI,KAAQN,IAAH,UAAcD,EAAEQ,KAAF,EAApB,EAA1C;AACAxC,OAAIe,OAAJ,CAAYU,KAAZ;AACAvB,SAAM,EAACc,MAAM,QAAP,EAAiByB,QAAQ,IAAzB,EAA+BxB,SAAYmB,EAAEG,GAAd,MAA/B,EAAN;AACAvC,OAAIY,SAAJ,CAAcC,IAAd,CAAmB,EAACC,UAAU,KAAX,EAAnB;AACA,GAlBD;AAmBA;AACD,UAAS4B,eAAT,GAA2B;AAC1B,MAAMvD,IAAIS,KAAKC,QAAf;AACA,MAAM8C,IAAI/C,KAAKG,QAAf;AACA,MAAMZ,KAAKA,EAAEyD,MAAF,IAAYnD,cAAlB,IAAsCkD,KAAKA,EAAEC,MAAF,IAAYlD,cAA5D,EAA8E;AAC7EM,OAAI6C,MAAJ,CAAWhC,IAAX,CAAgB,EAACC,UAAU,KAAX,EAAhB;AACA,GAFD,MAEO;AACNd,OAAI6C,MAAJ,CAAWhC,IAAX,CAAgB,EAACC,UAAU,IAAX,EAAhB;AACA;AACD;AACD,UAASgC,KAAT,CAAeC,CAAf,EAAkB;AACjB,MAAIxC,KAAKY,EAAE4B,EAAEC,MAAJ,CAAT;AACA,MAAIC,MAAM1C,GAAG0C,GAAH,EAAV;AACA,MAAIC,MAAM3C,GAAGX,IAAH,GAAUW,EAApB;AACA,MAAI4C,MAAMD,QAAQ,UAAR,GAAqBzD,cAArB,GAAsCC,cAAhD;AACAE,OAAKsD,GAAL,IAAYD,GAAZ;AACA,MAAIA,IAAIL,MAAJ,IAAcO,GAAlB,EAAuB;AACtB5C,MAAG6C,WAAH,CAAe,gBAAf,EAAiCC,QAAjC,CAA0C,iBAA1C;AACA,GAFD,MAEO;AACN9C,MAAG6C,WAAH,CAAe,iBAAf,EAAkCC,QAAlC,CAA2C,gBAA3C;AACA;AACDX;AACA;AACD,UAASY,KAAT,CAAeC,EAAf,EAAmB;AAClBpC,IAAE,UAAF,EAAcS,MAAd;AACA3B,aAAWsD,EAAX;AACAtE,KAAGuE,SAAH,CAAalE,IAAb;AACA,MAAImE,SAASzD,IAAIH,QAAJ,CAAa6D,GAAb,CAAiB1D,IAAID,QAArB,CAAb;AACA0D,SAAOR,GAAP,CAAW,EAAX;AACAQ,SAAO5C,IAAP,CAAY,EAACC,UAAU,KAAX,EAAZ;AACAd,MAAIH,QAAJ,CAAaoD,GAAb,CAAiB,EAAjB,EAAqBU,KAArB;AACAjB;AACA;AACD,UAASkB,IAAT,GAAgB;AACf5D,QAAMb,EAAE0E,MAAF,CAASvE,IAAT,CAAN;;AAEAU,MAAIH,QAAJ,CAAaiE,EAAb,CAAgB,yBAAhB,EAA2ChB,KAA3C;AACA9C,MAAID,QAAJ,CAAa+D,EAAb,CAAgB,yBAAhB,EAA2ChB,KAA3C;AACA9C,MAAI6C,MAAJ,CAAWiB,EAAX,CAAc,OAAd,EAAuB,aAAK;AAC3B,OAAIf,EAAEC,MAAF,CAASlC,QAAb,EAAuB;AACvBH;AACA,GAHD;AAIA;;AAEDzB,MAAK0E,IAAL,GAAYA,IAAZ;AACA1E,MAAKoE,KAAL,GAAaA,KAAb;AACAS,QAAOC,KAAP,GAAe9E,IAAf;AACA,QAAOA,IAAP;AACA,CA/FD","file":"login.js","sourcesContent":["define([\"core/config\", \"core/uk\"], (conf, uk) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst ROOT = \"[data-root='login']\";\r\n\tconst temp = u.getTemps(\"login/\");\r\n\t\r\n\tconst MIN_USER_CHARS = 4;\r\n\tconst MIN_PASS_CHARS = 4;\r\n\tconst ALERT_TIMEOUT = 4000;\r\n\t\r\n\t\r\n\tconst data = {\r\n\t\tusername: undefined,\r\n\t\tpassword: undefined\r\n\t};\r\n\tlet els, callback;\r\n\t\r\n\t\r\n\tfunction alert(ctx, keep) {\r\n\t\tlet alerts = els.alerts;\r\n\t\talerts.append( temp.alert(ctx) );\r\n\t\tif (!keep) {\r\n\t\t\tlet el = alerts.find(\"[uk-alert]:last-child [uk-close]\");\r\n\t\t\tsetTimeout(() => el.click(), ALERT_TIMEOUT);\r\n\t\t}\r\n\t}\r\n\tfunction request() {\r\n\t\tels.toDisable.attr({disabled: true});\r\n\t\tels.process.append( temp.alert({type: \"primary\", process: true, message: \"Processing your request...\", noClose: true}) );\r\n\t\t$.ajax({\r\n\t\t\turl: conf.BASE + \"user/login\",\r\n\t\t\tmethod: \"POST\",\r\n\t\t\tdata: data\r\n\t\t})\r\n\t\t.done(d => {\r\n\t\t\tels.process.empty();\r\n\t\t\talert({type: \"success\", success: true, message: \"Login Succesfull.\"}, true);\r\n\t\t\tCookies.remove(\"user\");\r\n\t\t\tCookies.set(\"user\", d);\r\n\t\t\tcallback();\r\n\t\t})\r\n\t\t.fail((x, stat) => {\r\n\t\t\tlet resTxt = x.responseText;\r\n\t\t\to = resTxt ? JSON.parse(x.responseText) : {Msg: `${stat}: ` + x.state()};\r\n\t\t\tels.process.empty();\r\n\t\t\talert({type: \"danger\", danger: true, message: `${o.Msg}.`});\r\n\t\t\tels.toDisable.attr({disabled: false});\r\n\t\t});\r\n\t}\r\n\tfunction changeSubmitBtn() {\r\n\t\tconst u = data.username;\r\n\t\tconst p = data.password;\r\n\t\tif ( (u && u.length >= MIN_USER_CHARS) && (p && p.length >= MIN_PASS_CHARS) ) {\r\n\t\t\tels.submit.attr({disabled: false});\r\n\t\t} else {\r\n\t\t\tels.submit.attr({disabled: true});\r\n\t\t}\r\n\t}\r\n\tfunction keyup(e) {\r\n\t\tlet el = $(e.target);\r\n\t\tlet val = el.val();\r\n\t\tlet key = el.data().el;\r\n\t\tlet min = key === \"username\" ? MIN_USER_CHARS : MIN_PASS_CHARS;\r\n\t\tdata[key] = val;\r\n\t\tif (val.length >= min) {\r\n\t\t\tel.removeClass(\"uk-form-danger\").addClass(\"uk-form-success\");\r\n\t\t} else {\r\n\t\t\tel.removeClass(\"uk-form-success\").addClass(\"uk-form-danger\");\r\n\t\t}\r\n\t\tchangeSubmitBtn();\r\n\t}\r\n\tfunction start(cb) {\r\n\t\t$(\"#overlay\").remove();\r\n\t\tcallback = cb;\r\n\t\tuk.openModal(ROOT);\r\n\t\tlet inpust = els.username.add(els.password);\r\n\t\tinpust.val(\"\");\r\n\t\tinpust.attr({disabled: false});\r\n\t\tels.username.val(\"\").focus();\r\n\t\tchangeSubmitBtn();\r\n\t}\r\n\tfunction init() {\r\n\t\tels = u.getEls(ROOT);\r\n\t\t\r\n\t\tels.username.on(\"keyup blur input change\", keyup);\r\n\t\tels.password.on(\"keyup blur input change\", keyup);\r\n\t\tels.submit.on(\"click\", e => {\r\n\t\t\tif (e.target.disabled) return;\r\n\t\t\trequest();\r\n\t\t});\r\n\t}\r\n\t\r\n\tinst.init = init;\r\n\tinst.start = start;\r\n\twindow.login = inst;\r\n\treturn inst;\r\n});"]}
{"version":3,"sources":["../../../../../src/js/wizard/wiz2/service.js"],"names":["define","conf","token","inst","u","extend","newPubSub","el","deviceId","initSelect2","select2","width","placeholder","ajax","method","url","BASE","dataType","delay","data","o","params","term","search","page","device_ids","JSON","stringify","error","x","status","emit","processResults","target","service","res","forEach","push","id","i","ID","text","Name","results","pagination","more","total_page","cache","multiple","minimumInputLength","on","e","getData","parseInt","val","name","setValue","append","$","change","clear","empty","setDeviceId","toggle","attr","disabled","b","init","el_"],"mappings":"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","file":"service.js","sourcesContent":["define([\"core/config\", \"core/token\"], (conf, token) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tlet el;\r\n\tlet deviceId;\r\n\t\r\n\tfunction initSelect2() {\r\n\t\tel.select2({\r\n\t\t\twidth: \"100%\",\r\n\t\t\tplaceholder: \"Select a service\",\r\n\t\t\tajax: {\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\turl: () => conf.BASE + \"device/service/search\" + token(),\r\n\t\t\t\tdataType: \"json\",\r\n\t\t\t\tdelay: 250,\r\n\t\t\t\tdata: params => {\r\n\t\t\t\t\tlet o = {};\r\n\t\t\t\t\tif (params.term) {\r\n\t\t\t\t\t\to.search = params.term;\r\n\t\t\t\t\t}\r\n\t\t\t\t\to.page = params.page || 1;\r\n\t\t\t\t\to.device_ids = JSON.stringify([ deviceId ]);\r\n\t\t\t\t\treturn o;\r\n\t\t\t\t},\r\n\t\t\t\terror: x => {\r\n\t\t\t\t\tif (x.status === 403) {\r\n\t\t\t\t\t\tel.select2(\"close\");\r\n\t\t\t\t\t\tinst.emit(\"login_error\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tprocessResults: (data, params) => {\r\n\t\t\t\t\tlet target = data.service;\r\n\t\t\t\t\tlet res = [];\r\n\t\t\t\t\tparams.page = params.page || 1;\r\n\t\t\t\t\tif (target) {\r\n\t\t\t\t\t\ttarget.forEach(i => {\r\n\t\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\tid: i.ID,\r\n\t\t\t\t\t\t\t\ttext: i.Name\r\n\t\t\t\t\t\t\t//\ttext: u.substrAfterLast(\".\", i.Name)\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tresults: res,\r\n\t\t\t\t\t\tpagination: {\r\n\t\t\t\t\t\t\tmore: params.page < data.total_page\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t},\r\n\t\t\t\tcache: false\r\n\t\t\t},\r\n\t\t\tmultiple: false,\r\n\t\t\tminimumInputLength: 0\r\n\t\t})\r\n\t\t.on(\"select2:select\", e => {\r\n\t\t\tinst.emit(\"select\", e.params.data.id);\r\n\t\t});\r\n\t}\r\n\t\r\n\tinst.getData = () => {\r\n\t\treturn {\r\n\t\t\tid: parseInt(el.val(), 10),\r\n\t\t\tname: el.text()\r\n\t\t};\r\n\t};\r\n\tinst.setValue = service => {\r\n\t\tel\r\n\t\t\t.append( $(\"<option></option>\").val(service.id).text(service.name) )\r\n\t\t\t.change();\r\n\t\treturn inst;\r\n\t};\r\n\tinst.clear = () => {\r\n\t\tel.empty().val(null).change();\r\n\t\treturn inst;\r\n\t};\r\n\tinst.setDeviceId = id => {\r\n\t\tdeviceId = id;\r\n\t\treturn inst;\r\n\t};\r\n\tinst.toggle = b => {\r\n\t\tel.attr({disabled: !b});\r\n\t\treturn inst;\r\n\t};\r\n\tinst.init = el_ => {\r\n\t\tel = el_;\r\n\t\tinitSelect2();\r\n\t\t\r\n\t};\r\n\t\r\n\treturn inst;\r\n});"]}
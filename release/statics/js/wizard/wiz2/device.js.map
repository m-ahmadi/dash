{"version":3,"sources":["../../../../../src/js/wizard/wiz2/device.js"],"names":["define","conf","token","inst","u","extend","newPubSub","el","initSelect2","select2","width","placeholder","ajax","method","url","BASE","dataType","delay","data","o","params","term","search","page","error","x","status","emit","processResults","target","devices","res","forEach","push","id","i","ID","text","Name","results","pagination","more","total_page","cache","multiple","minimumInputLength","on","e","getData","parseInt","val","name","setValue","append","$","device","change","toggle","attr","disabled","b","clear","empty","init","el_"],"mappings":"AAAAA,OAAO,CAAC,aAAD,EAAgB,YAAhB,CAAP,EAAsC,UAACC,IAAD,EAAOC,KAAP,EAAiB;AACtD,KAAMC,OAAOC,EAAEC,MAAF,CAAUC,WAAV,CAAb;;AAEA,KAAIC,WAAJ;;AAEA,UAASC,WAAT,GAAuB;AACtBD,KAAGE,OAAH,CAAW;AACVC,UAAO,MADG;AAEVC,gBAAa,eAFH;AAGVC,SAAM;AACLC,YAAQ,KADH;AAELC,SAAK;AAAA,YAAMb,KAAKc,IAAL,GAAY,eAAZ,GAA8Bb,OAApC;AAAA,KAFA;AAGLc,cAAU,MAHL;AAILC,WAAO,GAJF;AAKLC,UAAM,sBAAU;AACf,SAAIC,IAAI,EAAR;AACA,SAAIC,OAAOC,IAAX,EAAiB;AAChBF,QAAEG,MAAF,GAAWF,OAAOC,IAAlB;AACA;AACDF,OAAEI,IAAF,GAASH,OAAOG,IAAP,IAAe,CAAxB;AACA,YAAOJ,CAAP;AACA,KAZI;AAaLK,WAAO,kBAAK;AACX,SAAIC,EAAEC,MAAF,KAAa,GAAjB,EAAsB;AACrBnB,SAAGE,OAAH,CAAW,OAAX;AACAN,WAAKwB,IAAL,CAAU,aAAV;AACA;AACD,KAlBI;AAmBLC,oBAAgB,wBAACV,IAAD,EAAOE,MAAP,EAAkB;AACjC,SAAIS,SAASX,KAAKY,OAAlB;AACA,SAAIC,MAAM,EAAV;AACAX,YAAOG,IAAP,GAAcH,OAAOG,IAAP,IAAe,CAA7B;AACA,SAAIM,MAAJ,EAAY;AACXA,aAAOG,OAAP,CAAe,aAAK;AACnBD,WAAIE,IAAJ,CAAS;AACRC,YAAIC,EAAEC,EADE;AAERC,cAAMF,EAAEG;AAFA,QAAT;AAIA,OALD;AAMA;AACD,YAAO;AACNC,eAASR,GADH;AAENS,kBAAY;AACXC,aAAMrB,OAAOG,IAAP,GAAcL,KAAKwB;AADd;AAFN,MAAP;AAMA,KArCI;AAsCLC,WAAO;AAtCF,IAHI;AA2CVC,aAAU,KA3CA;AA4CVC,uBAAoB;AA5CV,GAAX,EA8CCC,EA9CD,CA8CI,gBA9CJ,EA8CsB,aAAK;AAC1B3C,QAAKwB,IAAL,CAAU,QAAV,EAAoBoB,EAAE3B,MAAF,CAASF,IAAT,CAAcgB,EAAlC;AACA,GAhDD;AAiDA;;AAED/B,MAAK6C,OAAL,GAAe,YAAM;AACpB,SAAO;AACNd,OAAIe,SAAS1C,GAAG2C,GAAH,EAAT,EAAmB,EAAnB,CADE;AAENC,SAAM5C,GAAG8B,IAAH;AAFA,GAAP;AAIA,EALD;AAMAlC,MAAKiD,QAAL,GAAgB,kBAAU;AACzB7C,KACE8C,MADF,CACUC,EAAE,mBAAF,EAAuBJ,GAAvB,CAA2BK,OAAOrB,EAAlC,EAAsCG,IAAtC,CAA2CkB,OAAOJ,IAAlD,CADV,EAEEK,MAFF;AAGA,SAAOrD,IAAP;AACA,EALD;AAMAA,MAAKsD,MAAL,GAAc,aAAK;AAClBlD,KAAGmD,IAAH,CAAQ,EAACC,UAAU,CAACC,CAAZ,EAAR;AACA,SAAOzD,IAAP;AACA,EAHD;AAIAA,MAAK0D,KAAL,GAAa,YAAM;AAClBtD,KAAGuD,KAAH,GAAWZ,GAAX,CAAe,IAAf,EAAqBM,MAArB;AACA,SAAOrD,IAAP;AACA,EAHD;AAIAA,MAAK4D,IAAL,GAAY,eAAO;AAClBxD,OAAKyD,GAAL;;AAEAxD;AACA,SAAOL,IAAP;AACA,EALD;;AAOA,QAAOA,IAAP;AACA,CArFD","file":"device.js","sourcesContent":["define([\"core/config\", \"core/token\"], (conf, token) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\t\r\n\tlet el;\r\n\t\r\n\tfunction initSelect2() {\r\n\t\tel.select2({\r\n\t\t\twidth: \"100%\",\r\n\t\t\tplaceholder: \"Select a node\",\r\n\t\t\tajax: {\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\turl: () => conf.BASE + \"device/search\" + token(),\r\n\t\t\t\tdataType: \"json\",\r\n\t\t\t\tdelay: 250,\r\n\t\t\t\tdata: params => {\r\n\t\t\t\t\tlet o = {};\r\n\t\t\t\t\tif (params.term) {\r\n\t\t\t\t\t\to.search = params.term;\r\n\t\t\t\t\t}\r\n\t\t\t\t\to.page = params.page || 1;\r\n\t\t\t\t\treturn o;\r\n\t\t\t\t},\r\n\t\t\t\terror: x => {\r\n\t\t\t\t\tif (x.status === 403) {\r\n\t\t\t\t\t\tel.select2(\"close\");\r\n\t\t\t\t\t\tinst.emit(\"login_error\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tprocessResults: (data, params) => {\r\n\t\t\t\t\tlet target = data.devices;\r\n\t\t\t\t\tlet res = [];\r\n\t\t\t\t\tparams.page = params.page || 1;\r\n\t\t\t\t\tif (target) {\r\n\t\t\t\t\t\ttarget.forEach(i => {\r\n\t\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\tid: i.ID,\r\n\t\t\t\t\t\t\t\ttext: i.Name\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tresults: res,\r\n\t\t\t\t\t\tpagination: {\r\n\t\t\t\t\t\t\tmore: params.page < data.total_page\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t},\r\n\t\t\t\tcache: false\r\n\t\t\t},\r\n\t\t\tmultiple: false,\r\n\t\t\tminimumInputLength: 0\r\n\t\t})\r\n\t\t.on(\"select2:select\", e => {\r\n\t\t\tinst.emit(\"select\", e.params.data.id);\r\n\t\t});\r\n\t}\r\n\t\r\n\tinst.getData = () => {\r\n\t\treturn {\r\n\t\t\tid: parseInt(el.val(), 10),\r\n\t\t\tname: el.text()\r\n\t\t};\r\n\t};\r\n\tinst.setValue = device => {\r\n\t\tel\r\n\t\t\t.append( $(\"<option></option>\").val(device.id).text(device.name) )\r\n\t\t\t.change();\r\n\t\treturn inst;\r\n\t};\r\n\tinst.toggle = b => {\r\n\t\tel.attr({disabled: !b});\r\n\t\treturn inst;\r\n\t};\r\n\tinst.clear = () => {\r\n\t\tel.empty().val(null).change();\r\n\t\treturn inst;\r\n\t};\r\n\tinst.init = el_ => {\r\n\t\tel = el_;\r\n\t\t\r\n\t\tinitSelect2();\r\n\t\treturn inst;\r\n\t};\r\n\t\r\n\treturn inst;\r\n});"]}
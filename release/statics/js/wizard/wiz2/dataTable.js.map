{"version":3,"sources":["../../../../../src/js/wizard/wiz2/dataTable.js"],"names":["define","colorpick","inst","u","extend","newPubSub","temp","getTemps","parent","rows","randColor","brightness","rgb","Math","random","mix","mixedrgb","map","x","round","join","newRow","sensor","id","units","append","sensorRow","name","root","children","last","els","getEls","selectedUnit","filter","o","selected","undefined","select","val","change","init","color","randInt","onColorChange","on","newVal","e","target","value","emit","remove","toHex","toggle","b","toDisable","attr","disabled","spectrum","find","isEmptyObj","getUnits","selectedVal","trim","res","addRow","getData","data","Object","keys","forEach","row","k","doAll","action","arg","removeAll","toggleAll"],"mappings":"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","file":"dataTable.js","sourcesContent":["define([\"./colorpick\"], (colorpick) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst temp = u.getTemps(\"wizard/wiz2\");\r\n\t\r\n\tlet parent;\r\n\tlet rows = {};\r\n\t\r\n\tfunction randColor(brightness) {\r\n\t\t// Six levels of brightness from 0 to 5, 0 being the darkest\r\n\t\tvar rgb = [Math.random() * 256, Math.random() * 256, Math.random() * 256];\r\n\t\tvar mix = [brightness * 51, brightness * 51, brightness * 51]; //51 => 255/5\r\n\t\tvar mixedrgb = [rgb[0] + mix[0], rgb[1] + mix[1], rgb[2] + mix[2]].map(function (x) {\r\n\t\t\treturn Math.round(x / 2.0)\r\n\t\t})\r\n\t\treturn \"rgb(\" + mixedrgb.join(\",\") + \")\";\r\n\t}\r\n\t\r\n\tfunction newRow(sensor) {\r\n\t\tlet id = sensor.id;\r\n\t\tlet units = sensor.units;\r\n\t\tparent.append(temp.sensorRow({\r\n\t\t\tname: sensor.name,\r\n\t\t\tid: id,\r\n\t\t\tunits: units\r\n\t\t}));\r\n\t\tlet root = parent.children().last();\r\n\t\tlet els = u.getEls(root);\r\n\t\t\r\n\t\tlet selectedUnit = units.filter(o => o.selected ? o.name : undefined)[0];\r\n\t\tif (selectedUnit) {\r\n\t\t\tels.select.val(selectedUnit.name).change();\r\n\t\t}\r\n\t\tcolorpick.init(els.colorpick, sensor.color || randColor( u.randInt(0, 6) ), onColorChange);\r\n\t\tsensor.color = color();\r\n\t\t\r\n\t\tels.select.on(\"change\", e => {\r\n\t\t\tlet newVal = e.target.value;\r\n\t\t\tsensor.color = newVal;\r\n\t\t\tinst.emit(\"unit_change\", id, newVal);\r\n\t\t});\r\n\t\tels.remove.on(\"click\", remove);\r\n\t\t\r\n\t\tfunction onColorChange(color) {\r\n\t\t\tinst.emit( \"color_change\", id, color.toHex() );\r\n\t\t}\r\n\t\tfunction toggle(b) {\r\n\t\t\tels.toDisable.attr({disabled: !b});\r\n\t\t\tels.colorpick.spectrum(b ? \"enable\" : \"disable\");\r\n\t\t}\r\n\t\tfunction remove() {\r\n\t\t\tels.colorpick.spectrum(\"destroy\");\r\n\t\t\tparent.find(`> tr[data-id=\"${id}\"]`).remove();\r\n\t\t\tdelete rows[id];\r\n\t\t\t\r\n\t\t\tinst.emit(\"sensor_remove\", sensor);\r\n\t\t\tif ( u.isEmptyObj(rows) ) inst.emit(\"sensor_remove_all\");\r\n\t\t}\r\n\t\tfunction getUnits() {\r\n\t\t\tlet selectedVal = els.select.val().trim();\r\n\t\t\treturn sensor.units.map(o => {\r\n\t\t\t\tlet name = o.name;\r\n\t\t\t\tlet res = {\r\n\t\t\t\t\tname: name,\r\n\t\t\t\t\tselected: false\r\n\t\t\t\t};\r\n\t\t\t\tif (name === selectedVal) {\r\n\t\t\t\t\tres.selected = true;\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction color() {\r\n\t\t\treturn els.colorpick.spectrum(\"get\").toHex();\r\n\t\t}\r\n\t\t\r\n\t\treturn {\r\n\t\t\tid: id,\r\n\t\t\tname: sensor.name,\r\n\t\t\ttoggle, remove, getUnits, color\r\n\t\t};\r\n\t}\r\n\tfunction addRow(sensor) {\r\n\t\tlet id = sensor.id;\r\n\t\tif ( !rows[id] ) {\r\n\t\t\trows[id] = newRow(sensor);\r\n\t\t\tinst.emit(\"sensor_add\", id);\r\n\t\t}\r\n\t}\r\n\tfunction getData() {\r\n\t\tif ( u.isEmptyObj(rows) ) return;\r\n\t\tlet data = {};\r\n\t\tObject.keys(rows).forEach(k => {\r\n\t\t\tlet row = rows[k];\r\n\t\t\tlet id = row.id;\r\n\t\t\tdata[id] = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: row.name,\r\n\t\t\t\tunits: row.getUnits(),\r\n\t\t\t\tcolor: row.color()\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn data;\r\n\t}\r\n\tfunction doAll(action, arg) {\r\n\t\tObject.keys(rows).forEach( k => rows[k][action](arg) );\r\n\t}\r\n\tfunction init(root) {\r\n\t\tparent = root;\r\n\t\t\r\n\t}\r\n\t\r\n\tinst.removeAll = () => {\r\n\t\tdoAll(\"remove\");\r\n\t\treturn inst;\r\n\t};\r\n\tinst.toggleAll = b => doAll(\"toggle\", b);\r\n\tinst.addRow = addRow;\r\n\tinst.getData = getData;\r\n\tinst.init = init;\r\n\t\r\n\treturn inst;\r\n});"]}
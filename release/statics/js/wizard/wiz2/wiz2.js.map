{"version":3,"sources":["../../../../../src/js/wizard/wiz2/wiz2.js"],"names":["define","conf","token","uk","share","d","device","service","sensors","dataTable","inst","u","extend","newPubSub","ROOT","jsonParse","JSON","parse","jsonStr","stringify","els","c","add","edit","toggle","submit","b","attr","disabled","prev","toDisable","toggleAll","modal","sameKeys","a","k","Object","keys","aKeys","sort","bKeys","typeChange","val","e","target","value","n1","RANGE_COUNT_DEF","n2","RANGE_COUNT_MAX","rangeCount","countChange","el","$","type","rangeType","max","min","parseInt","num","curr","data","v","rc","count","change","get","rangeTypeVal","rangeCountVal","getData","rangeTitle","getRangeTitle","setForAdd","shallow","off","clear","on","setDeviceId","id","removeAll","setServiceId","load","clearReloaders","addRow","sensor","once","RANGE_TYPE","RANGE_COUNT","setForEdit","o","sens","setValue","map","forEach","sensorId","newValue","sen","units","filter","selected","name","rows","color","open","close","emitLoingErr","emit","set","init","getEls","btnParent","stat","table","success"],"mappings":"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","file":"wiz2.js","sourcesContent":["define([\r\n\t\"core/config\",\r\n\t\"core/token\",\r\n\t\"core/uk\",\r\n\t\"../share\",\r\n\t\"../defaults\",\r\n\t\"./device\",\r\n\t\"./service\",\r\n\t\"./sensors\",\r\n\t\"./dataTable\"\r\n], (\r\n\tconf,\r\n\ttoken,\r\n\tuk,\r\n\tshare,\r\n\td,\r\n\tdevice,\r\n\tservice,\r\n\tsensors,\r\n\tdataTable\r\n) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst ROOT = \"[data-root='wiz2']\";\r\n\tconst jsonParse = JSON.parse;\r\n\tconst jsonStr = JSON.stringify;\r\n\t\r\n\tlet els;\r\n\tlet c = { add: {}, edit: {} }; // event callbacks\r\n\tlet toggle = {\r\n\t\tsubmit(b) {\r\n\t\t\tels.submit.attr({disabled: !b});\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tprev(b) {\r\n\t\t\tels.prev.attr({disabled: !b});\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\ttoDisable(b) {\r\n\t\t\tels.toDisable.attr({disabled: !b});\r\n\t\t\tsensors.toggle(b);\r\n\t\t\tdataTable.toggleAll(b);\r\n\t\t},\r\n\t\tmodal(b) {\r\n\t\t\tuk[b ? \"openModal\" : \"closeModal\"](ROOT);\r\n\t\t}\r\n\t};\r\n\t\r\n\tfunction sameKeys(a, b) {\r\n\t\tlet k = Object.keys;\r\n\t\tlet aKeys = k(a).sort();\r\n\t\tlet bKeys = k(b).sort();\r\n\t\treturn jsonStr(aKeys) === jsonStr(bKeys);\r\n\t}\r\n\tc.add.typeChange = e => {\r\n\t\tlet val = e.target.value;\r\n\t\tlet n1 = d.RANGE_COUNT_DEF[val];\r\n\t\tlet n2 = d.RANGE_COUNT_MAX[val];\r\n\t\tels.rangeCount.val(n1);\r\n\t\tels.rangeCount.attr(\"max\", n2);\r\n\t};\r\n\tc.add.countChange = e => {\r\n\t\tlet el = $(e.target);\r\n\t\tlet type = els.rangeType.val();\r\n\t\tlet max = d.RANGE_COUNT_MAX[type];\r\n\t\tlet min = parseInt(el.attr(\"min\"), 10);\r\n\t\tlet val = el.val();\r\n\t\tif (val) {\r\n\t\t\tlet num = parseInt(val, 10);\r\n\t\t\tif (num > max) {\r\n\t\t\t\tel.val(max);\r\n\t\t\t} else if (num < min) {\r\n\t\t\t\tel.val(min);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tel.val( d.RANGE_COUNT_DEF[type] );\r\n\t\t}\r\n\t};\r\n\tc.edit.typeChange = e => {\r\n\t\tlet curr = e.data;\r\n\t\tlet v = e.target.value;\r\n\t\tlet rc = els.rangeCount;\r\n\t\tlet count = parseInt(rc.val(), 10);\r\n\t\trc.attr(\"max\", d.RANGE_COUNT_MAX[v]).change();\r\n\t\ttoggle.submit( v !== curr.type || count !== curr.count );\r\n\t};\r\n\tc.edit.countChange = e => {\r\n\t\tlet curr = e.data;\r\n\t\tlet el = $(e.target);\r\n\t\tlet type = els.rangeType.val();\r\n\t\tlet max = d.RANGE_COUNT_MAX[type];\r\n\t\tlet min = parseInt(el.attr(\"min\"), 10);\r\n\t\tlet val = el.val();\r\n\t\tif (val) {\r\n\t\t\tlet num = parseInt(val, 10);\r\n\t\t\tif (num > max) {\r\n\t\t\t\tel.val(max);\r\n\t\t\t} else if (num < min) {\r\n\t\t\t\tel.val(min);\r\n\t\t\t}\r\n\t\t\ttoggle.submit(num !== curr.count || type !== curr.type); \r\n\t\t} else {\r\n\t\t\tel.val( d.RANGE_COUNT_DEF[type] );\r\n\t\t}\r\n\t};\r\n\tfunction get() {\r\n\t\tlet rangeTypeVal = els.rangeType.val();\r\n\t\tlet rangeCountVal = els.rangeCount.val();\r\n\t\t\r\n\t\tlet data = {\r\n\t\t\tdevice: device.getData(),\r\n\t\t\tservice: service.getData(),\r\n\t\t\tsensors: dataTable.getData(),\r\n\t\t\trangeType: rangeTypeVal,\r\n\t\t\trangeCount: parseInt(rangeCountVal, 10),\r\n\t\t\trangeTitle: share.getRangeTitle( rangeTypeVal, rangeCountVal ),\r\n\t\t};\r\n\t\t\r\n\t\treturn data;\r\n\t}\r\n\tfunction setForAdd() {\r\n\t\tinst.shallow = true;\r\n\t\ttoggle.submit(false).prev(true);\r\n\t\t\r\n\t\tdevice\r\n\t\t\t.off()\r\n\t\t\t.clear()\r\n\t\t\t.on(\"select\", id => {\r\n\t\t\t\tservice\r\n\t\t\t\t\t.clear()\r\n\t\t\t\t\t.setDeviceId(id)\r\n\t\t\t\t\t.toggle(true);\r\n\t\t\t\tdataTable.removeAll();\r\n\t\t\t\tsensors.removeAll();\r\n\t\t\t});\r\n\t\tservice\r\n\t\t\t.off()\r\n\t\t\t.clear()\r\n\t\t\t.toggle(false)\r\n\t\t\t.on(\"select\", id => {\r\n\t\t\t\tdataTable.removeAll();\r\n\t\t\t\tsensors\r\n\t\t\t\t\t.removeAll()\r\n\t\t\t\t\t.setServiceId(id)\r\n\t\t\t\t\t.load();\r\n\t\t\t});\r\n\t\tsensors\r\n\t\t\t.off()\r\n\t\t\t.clearReloaders()\r\n\t\t\t.clear()\r\n\t\t\t.toggle(false)\r\n\t\t\t.on(\"select\", sensor => {\r\n\t\t\t\tdataTable.addRow(sensor);\r\n\t\t\t});\r\n\t\t\r\n\t\tdataTable\r\n\t\t\t.off()\r\n\t\t\t.removeAll()\r\n\t\t\t.once(\"sensor_add\", toggle.submit, true)\r\n\t\t\t.on(\"sensor_remove_all\", () => {\r\n\t\t\t\ttoggle.submit(false);\r\n\t\t\t\tdataTable.once(\"sensor_add\", toggle.submit, true);\r\n\t\t\t});\r\n\t\t\r\n\t\tels.rangeType\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", c.add.typeChange)\r\n\t\t\t.val(d.RANGE_TYPE)\r\n\t\t\t.change();\r\n\t\tels.rangeCount\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", c.add.countChange)\r\n\t\t\t.val(d.RANGE_COUNT)\r\n\t\t\t.change();\r\n\t}\r\n\tfunction setForEdit(o) {\r\n\t\tlet sens = o.sensors;\r\n\t\ttoggle.submit(false).prev(false);\r\n\t\t\r\n\t\tdataTable.off().removeAll();\r\n\t\tdevice.clear().setValue(o.device);\r\n\t\tservice\r\n\t\t\t.toggle(true)\r\n\t\t\t.setValue(o.service);\r\n\t\tsensors\r\n\t\t\t.toggle(false)\r\n\t\t\t.clearReloaders()\r\n\t\t\t.setServiceId(o.service.id)\r\n\t\t\t.load( Object.keys(sens).map( k => sens[k].id ) ); // filter out already selected\r\n\t\t\r\n\t\tdevice\r\n\t\t\t.off()\r\n\t\t\t.on(\"select\", id => {\r\n\t\t\t\tservice\r\n\t\t\t\t\t.clear()\r\n\t\t\t\t\t.setDeviceId(id)\r\n\t\t\t\t\t.toggle(true);\r\n\t\t\t\tdataTable.removeAll();\r\n\t\t\t\tsensors.removeAll();\r\n\t\t\t});\r\n\t\tservice\r\n\t\t\t.off()\r\n\t\t\t.on(\"select\", id => {\r\n\t\t\t\tdataTable.removeAll();\r\n\t\t\t\tsensors\r\n\t\t\t\t\t.removeAll()\r\n\t\t\t\t\t.setServiceId(id)\r\n\t\t\t\t\t.load();\r\n\t\t\t});\r\n\t\tsensors\r\n\t\t\t.off()\r\n\t\t\t.on(\"select\", sensor => {\r\n\t\t\t\t\r\n\t\t\t\tdataTable.addRow(sensor);\r\n\t\t\t});\r\n\t\t\r\n\t\tObject.keys(sens).forEach( k => dataTable.addRow(sens[k]) );\r\n\t\tdataTable\r\n\t\t\t.on(\"unit_change\", (sensorId, newValue) => {\r\n\t\t\t\tlet sen = sens[sensorId];\r\n\t\t\t\tif (sen) {\r\n\t\t\t\t\tlet curr = sen.units.filter(o => o.selected)[0].name;\r\n\t\t\t\t\ttoggle.submit(curr !== newValue);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on(\"sensor_remove\", sensor => {\r\n\t\t\t\tsensors.add(sensor);\r\n\t\t\t\tlet rows = dataTable.getData();\r\n\t\t\t\tif (rows) toggle.submit( !sameKeys(rows, sens) );\r\n\t\t\t})\r\n\t\t\t.on(\"sensor_add\", sensorId => {\r\n\t\t\t\tlet rows = dataTable.getData();\r\n\t\t\t\ttoggle.submit( !sameKeys(rows, sens) );\r\n\t\t\t})\r\n\t\t\t.on(\"color_change\", (sensorId, newValue) => {\r\n\t\t\t\tlet sen = sens[sensorId];\r\n\t\t\t\tif (sen) toggle.submit(sen.color !== newValue);\r\n\t\t\t})\r\n\t\t\t.on(\"sensor_remove_all\", () => {\r\n\t\t\t\ttoggle.submit(false);\r\n\t\t\t});\r\n\t\t\r\n\t\tlet type = o.rangeType;\r\n\t\tlet count = o.rangeCount;\r\n\t\tlet curr = {\r\n\t\t\ttype: type,\r\n\t\t\tcount: count\r\n\t\t};\r\n\t\tels.rangeType\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", curr, c.edit.typeChange)\r\n\t\t\t.val(type)\r\n\t\t\t.change();\r\n\t\t\t\r\n\t\tels.rangeCount\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", curr, c.edit.countChange)\r\n\t\t\t.val(count)\r\n\t\t\t.change();\r\n\t\t\r\n\t}\r\n\tfunction open() {\r\n\t\ttoggle.modal(true);\r\n\t\treturn inst;\r\n\t}\r\n\tfunction close() {\r\n\t\tinst.shallow = false;\r\n\t\ttoggle.modal(false);\r\n\t}\r\n\tfunction emitLoingErr() {\r\n\t\tinst.emit(\"login_error\");\r\n\t}\r\n\t\r\n\tinst.shallow = false;\r\n\tinst.open = open;\r\n\tinst.set = o => {\r\n\t\to ? setForEdit(o) : setForAdd();\r\n\t\treturn inst;\r\n\t};\r\n\tinst.init = () => {\r\n\t\tels = u.getEls(ROOT);\r\n\t\t\r\n\t\tdevice.init(els.device);\r\n\t\tservice.init(els.service);\r\n\t\tsensors.init( {sensors: els.sensors, btnParent: els.btnParent, stat: els.stat} );\r\n\t\tdataTable.init(els.table);\r\n\t\t\r\n\t\tels.prev.on(\"click\", e => {\r\n\t\t\tif (e.target.disabled) return;\r\n\t\t\tinst.emit(\"prev\");\r\n\t\t});\r\n\t\tels.submit.on(\"click\", e => {\r\n\t\t\tif (e.target.disabled) return;\r\n\t\t\tlet toggleAll = toggle.toDisable;\r\n\t\t\t\r\n\t\t\ttoggleAll(false);\r\n\t\t\tinst.emit(\"submit\", get(), success => {\r\n\t\t\t\tif (success) {\r\n\t\t\t\t\tclose();\r\n\t\t\t\t}\r\n\t\t\t\ttoggleAll(true);\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tdevice.on(\"login_error\", emitLoingErr);\r\n\t\tservice.on(\"login_error\", emitLoingErr);\r\n\t\tsensors.on(\"login_error\", emitLoingErr);\r\n\t};\r\n\t\r\n\treturn inst;\r\n});"]}
{"version":3,"sources":["../../../../src/js/wizard/wizard.js"],"names":["define","conf","token","uk","d","share","wiz1","wiz2","wiz3","wiz4","inst","u","extend","newPubSub","id","order","addMode","shallow","w","prefetch","uid","Math","floor","random","newData","data","type","rangeType","rangeCount","rangeTitle","device","service","sensors","group","statKpis","expand","min","merge","o","get","Object","keys","forEach","k","start","childs","undefined","set","open","edit","JSON","parse","stringify","emitLoginErr","cb","emit","emitSubmit","eStr","go","which","back","state","addCustomEvt","on","t","groupsArr","setGroups","renderForm","fetchGroups","init"],"mappings":"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","file":"wizard.js","sourcesContent":["define([\r\n\t\"core/config\",\r\n\t\"core/token\",\r\n\t\"core/uk\",\r\n\t\"./defaults\",\r\n\t\"./share\",\r\n\t\"./wiz1\",\r\n\t\"./wiz2/wiz2\",\r\n\t\"./wiz3\",\r\n\t\"./wiz4/wiz4\"\r\n], (\r\n\tconf,\r\n\ttoken,\r\n\tuk,\r\n\td,\r\n\tshare,\r\n\twiz1,\r\n\twiz2,\r\n\twiz3,\r\n\twiz4\r\n) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\t\r\n\tlet id, order, addMode, shallow;\r\n\tlet w;\r\n\tlet prefetch = true;\r\n\t\r\n\tfunction uid() {\r\n\t\treturn Math.floor( Math.random() * 1000 );\r\n\t}\r\n\tfunction newData() {\r\n\t\tlet data = {\r\n\t\t\tid:         id || uid(),\r\n\t\t\ttype:       null,\r\n\t\t\trangeType:  null,\r\n\t\t\trangeCount: null,\r\n\t\t\trangeTitle: null,\r\n\t\t\tdevice:     null,\r\n\t\t\tservice:    null,\r\n\t\t\tsensors:    null,\r\n\t\t\tgroup:      null,\r\n\t\t\tstatKpis:   null,\r\n\t\t\torder:      order,\r\n\t\t\texpand:     0,\r\n\t\t\tmin:        false\r\n\t\t};\r\n\t\treturn data;\r\n\t}\r\n\tfunction merge(o) {\r\n\t\tlet data = newData();\r\n\t\t\r\n\t\tdata.type = wiz1.get();\r\n\t\t\r\n\t\tObject.keys(o).forEach(k => {\r\n\t\t\tdata[k] = o[k];\r\n\t\t});\r\n\t\t\r\n\t\treturn data;\r\n\t}\r\n\tfunction start(childs) {\r\n\t\taddMode = true;\r\n\t\tshallow = false;\r\n\t\tw = undefined;\r\n\t\tid = undefined;\r\n\t\torder = childs ? childs : 0;\r\n\t\twiz1.set().open();\r\n\t}\r\n\tfunction edit(o) {\r\n\t\taddMode = false;\r\n\t\tshallow = false;\r\n\t\tw = JSON.parse( JSON.stringify(o) ); // deep copy\r\n\t\tid = w.id;\r\n\t\torder = w.order;\r\n\t\twiz1.set(w);\r\n\t\tswitch (w.type) {\r\n\t\t\tcase 0: wiz2.set(w).open(); break;\r\n\t\t\tcase 1: wiz3.set(w).open(); break;\r\n\t\t\tcase 2: wiz3.set(w).open(); break;\r\n\t\t\tcase 3: wiz4.set(w).open(); break;\r\n\t\t}\r\n\t}\r\n\tfunction emitLoginErr(cb) {\r\n\t\tinst.emit(\"login_error\", cb);\r\n\t}\r\n\tfunction emitSubmit(data, cb) {\r\n\t\tlet eStr = addMode ? \"submit:create\" : \"submit:edit\";\r\n\t\tinst.emit(eStr, merge(data), cb);\r\n\t}\r\n\tfunction go(which) {\r\n\t\tif (!which.shallow) {\r\n\t\t\tif (addMode) {\r\n\t\t\t\twhich.set();\r\n\t\t\t} else {\r\n\t\t\t\twhich.set(w);\r\n\t\t\t}\r\n\t\t}\r\n\t\twhich.open();\r\n\t}\r\n\tfunction back(state) {\r\n\t\tshallow = state;\r\n\t\twiz1.open();\r\n\t}\r\n\tfunction addCustomEvt() {\r\n\t\twiz1.on(\"next\", t => {\r\n\t\t\tif (t === 0) {\r\n\t\t\t\tgo(wiz2);\r\n\t\t\t} else if (t === 1) {\r\n\t\t\t\tgo(wiz3);\r\n\t\t\t} else if (t === 2) {\r\n\t\t\t\tgo(wiz3);\r\n\t\t\t} else if (t === 3) {\r\n\t\t\t\tgo(wiz4);\r\n\t\t\t}\r\n\t\t});\r\n\t\twiz2.on(\"prev\", back);\r\n\t\twiz3.on(\"prev\", back);\r\n\t\twiz4.on(\"prev\", back);\r\n\t\t\r\n\t\twiz2\r\n\t\t\t.on(\"submit\", emitSubmit)\r\n\t\t\t.on(\"login_error\", emitLoginErr, wiz2.open);\r\n\t\t\r\n\t\twiz3\r\n\t\t\t.on(\"submit\", emitSubmit)\r\n\t\t\t.on(\"login_error\", emitLoginErr, wiz3.open)\r\n\t\t\t.on(\"group_fetch_succ\", (groupsArr) => {\r\n\t\t\t\twiz4.setGroups(groupsArr).renderForm();\r\n\t\t\t})\r\n\t\t\t.on(\"group_fetch_fail\", () => {\r\n\t\t\t\twiz4.fetchGroups();\r\n\t\t\t});\r\n\t\t\r\n\t\twiz4\r\n\t\t\t.on(\"submit\", emitSubmit)\r\n\t\t\t.on(\"login_error\", emitLoginErr, wiz4.open);\r\n\t}\r\n\r\n\tinst.start = start;\r\n\tinst.edit = edit;\r\n\t\r\n\tinst.init = () => {\r\n\t\twiz1.init();\r\n\t\twiz2.init();\r\n\t\twiz3.init();\r\n\t\twiz4.init();\r\n\t\t\r\n\t\taddCustomEvt();\r\n\t};\r\n\tinst.fetchGroups = () => {\r\n\t\twiz3.fetchGroups(); \r\n\t};\r\n\t\r\n\treturn inst;\r\n});"]}
{"version":3,"sources":["../../../../../src/js/wizard/wiz4/device.js"],"names":["define","conf","token","inst","u","extend","newPubSub","el","initSelect2","select2","width","placeholder","ajax","method","url","BASE","dataType","delay","data","o","params","term","search","page","error","x","status","emit","processResults","target","devices","res","forEach","push","id","i","ID","text","Name","results","pagination","more","total_page","cache","multiple","minimumInputLength","on","val","change","selected","e","device","name","init","root"],"mappings":"AAAAA,OAAO,CAAC,aAAD,EAAgB,YAAhB,CAAP,EAAsC,UAACC,IAAD,EAAOC,KAAP,EAAiB;AACtD,KAAMC,OAAOC,EAAEC,MAAF,CAAUC,WAAV,CAAb;;AAEA,KAAIC,WAAJ;;AAEA,UAASC,WAAT,GAAuB;AACtBD,KAAGE,OAAH,CAAW;AACVC,UAAO,MADG;AAEVC,gBAAa,OAFH;AAGVC,SAAM;AACLC,YAAQ,KADH;AAELC,SAAK;AAAA,YAAMb,KAAKc,IAAL,GAAY,eAAZ,GAA8Bb,OAApC;AAAA,KAFA;AAGLc,cAAU,MAHL;AAILC,WAAO,GAJF;AAKLC,UAAM,sBAAU;AACf,SAAIC,IAAI,EAAR;AACA,SAAIC,OAAOC,IAAX,EAAiB;AAChBF,QAAEG,MAAF,GAAWF,OAAOC,IAAlB;AACA;AACDF,OAAEI,IAAF,GAASH,OAAOG,IAAP,IAAe,CAAxB;AACA,YAAOJ,CAAP;AACA,KAZI;AAaLK,WAAO,kBAAK;AACX,SAAIC,EAAEC,MAAF,KAAa,GAAjB,EAAsB;AACrBnB,SAAGE,OAAH,CAAW,OAAX;AACAN,WAAKwB,IAAL,CAAU,aAAV;AACA;AACD,KAlBI;AAmBLC,oBAAgB,wBAACV,IAAD,EAAOE,MAAP,EAAkB;AACjC,SAAIS,SAASX,KAAKY,OAAlB;AACA,SAAIC,MAAM,EAAV;AACAX,YAAOG,IAAP,GAAcH,OAAOG,IAAP,IAAe,CAA7B;AACA,SAAIM,MAAJ,EAAY;AACXA,aAAOG,OAAP,CAAe,aAAK;AACnBD,WAAIE,IAAJ,CAAS;AACRC,YAAIC,EAAEC,EADE;AAERC,cAAMF,EAAEG;AAFA,QAAT;AAIA,OALD;AAMA;AACD,YAAO;AACNC,eAASR,GADH;AAENS,kBAAY;AACXC,aAAMrB,OAAOG,IAAP,GAAcL,KAAKwB;AADd;AAFN,MAAP;AAMA,KArCI;AAsCLC,WAAO;AAtCF,IAHI;AA2CVC,aAAU,KA3CA;AA4CVC,uBAAoB;AA5CV,GAAX,EA8CCC,EA9CD,CA8CI,gBA9CJ,EA8CsB,aAAK;AAC1BvC,MAAGwC,GAAH,CAAO,IAAP,EAAaC,MAAb;AACA,OAAIC,WAAWC,EAAE9B,MAAF,CAASF,IAAxB;AACA,OAAIiC,SAAS;AACZjB,QAAIe,SAASf,EADD;AAEZkB,UAAMH,SAASZ;AAFH,IAAb;AAIAlC,QAAKwB,IAAL,CAAU,QAAV,EAAoBwB,MAApB;AACA,GAtDD;AAuDA;;AAEDhD,MAAKkD,IAAL,GAAY,gBAAQ;AACnB9C,OAAK+C,IAAL;AACA9C;AACA,EAHD;;AAKA,QAAOL,IAAP;AACA,CArED","file":"device.js","sourcesContent":["define([\"core/config\", \"core/token\"], (conf, token) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\t\r\n\tlet el;\r\n\t\r\n\tfunction initSelect2() {\r\n\t\tel.select2({\r\n\t\t\twidth: \"100%\",\r\n\t\t\tplaceholder: \"Nodes\",\r\n\t\t\tajax: {\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\turl: () => conf.BASE + \"device/search\" + token(),\r\n\t\t\t\tdataType: \"json\",\r\n\t\t\t\tdelay: 250,\r\n\t\t\t\tdata: params => {\r\n\t\t\t\t\tlet o = {};\r\n\t\t\t\t\tif (params.term) {\r\n\t\t\t\t\t\to.search = params.term;\r\n\t\t\t\t\t}\r\n\t\t\t\t\to.page = params.page || 1;\r\n\t\t\t\t\treturn o;\r\n\t\t\t\t},\r\n\t\t\t\terror: x => {\r\n\t\t\t\t\tif (x.status === 403) {\r\n\t\t\t\t\t\tel.select2(\"close\");\r\n\t\t\t\t\t\tinst.emit(\"login_error\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tprocessResults: (data, params) => {\r\n\t\t\t\t\tlet target = data.devices;\r\n\t\t\t\t\tlet res = [];\r\n\t\t\t\t\tparams.page = params.page || 1;\r\n\t\t\t\t\tif (target) {\r\n\t\t\t\t\t\ttarget.forEach(i => {\r\n\t\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\tid: i.ID,\r\n\t\t\t\t\t\t\t\ttext: i.Name\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tresults: res,\r\n\t\t\t\t\t\tpagination: {\r\n\t\t\t\t\t\t\tmore: params.page < data.total_page\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t},\r\n\t\t\t\tcache: false\r\n\t\t\t},\r\n\t\t\tmultiple: false,\r\n\t\t\tminimumInputLength: 0\r\n\t\t})\r\n\t\t.on(\"select2:select\", e => {\r\n\t\t\tel.val(null).change();\r\n\t\t\tlet selected = e.params.data;\r\n\t\t\tlet device = {\r\n\t\t\t\tid: selected.id,\r\n\t\t\t\tname: selected.text\r\n\t\t\t};\r\n\t\t\tinst.emit(\"select\", device);\r\n\t\t});\r\n\t}\r\n\t\r\n\tinst.init = root => {\r\n\t\tel = root;\r\n\t\tinitSelect2();\r\n\t};\r\n\t\r\n\treturn inst;\r\n});"]}
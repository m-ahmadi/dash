{"version":3,"sources":["../../../../../src/js/wizard/wiz4/wiz4.js"],"names":["define","uk","conf","token","d","share","device","dataTable","inst","u","extend","newPubSub","ROOT","temp","getTemps","els","c","add","edit","groups","checkboxes","firstGroupFetch","toggle","submit","b","attr","disabled","prev","toDisable","prop","fetchGroups","html","loading","$","ajax","url","BASE","method","data","done","arr","Groups","forEach","push","name","i","Name","id","ID","setGroups","renderForm","fail","x","status","emit","clearAlerts","danger","empty","unshift","Error","g","formRow","find","retry","typeChange","val","e","target","value","n1","RANGE_COUNT_DEF","n2","RANGE_COUNT_MAX","rangeCount","countChange","el","type","rangeType","max","min","parseInt","num","curr","v","rc","count","change","setChk","selected","checked","each","l","indexOf","filter","setForAdd","shallow","on","removeAll","off","addRow","violated","live","setForEdit","o","m","map","devices","Object","keys","k","get","res","getData","close","closeModal","set","open","openModal","init","getEls","table","chks","toggleAll","success","window","w4"],"mappings":"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","file":"wiz4.js","sourcesContent":["define([\r\n\t\"core/uk\",\r\n\t\"core/config\",\r\n\t\"core/token\",\r\n\t\"../defaults\",\r\n\t\"../share\",\r\n\t\"./device\",\r\n\t\"./dataTable\"\r\n], (uk, conf, token, d, share, device, dataTable) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst ROOT = \"[data-root='wiz4']\";\r\n\tconst temp = u.getTemps(\"wizard/wiz4\");\r\n\t\r\n\tlet els;\r\n\tlet c = { add: {}, edit: {} };\r\n\tlet groups;\r\n\tlet checkboxes = newPubSub();\r\n\tlet firstGroupFetch = true;\r\n\tlet toggle = {\r\n\t\tsubmit(b) {\r\n\t\t\tels.submit.attr({disabled: !b});\r\n\t\t},\r\n\t\tprev(b) {\r\n\t\t\tels.prev.attr({disabled: !b});\r\n\t\t},\r\n\t\ttoDisable(b) {\r\n\t\t\tels.toDisable.prop({disabled: !b});\r\n\t\t}\r\n\t};\r\n\t\r\n\tfunction fetchGroups() {\r\n\t\tif (!firstGroupFetch) {\r\n\t\t\tels.groups.html( temp.loading() );\r\n\t\t}\r\n\t\t$.ajax({\r\n\t\t\turl: conf.BASE + \"device/grouptree\" + token(),\r\n\t\t\tmethod: \"GET\",\r\n\t\t\tdata: \"parent_only=true\"\r\n\t\t})\r\n\t\t.done(d => {\r\n\t\t\tlet arr = [];\r\n\t\t\td.groups[0].Groups.forEach( i => arr.push({name: i.Name, id: i.ID}) );\r\n\t\t\tsetGroups(arr);\r\n\t\t\trenderForm();\r\n\t\t})\r\n\t\t.fail(x => {\r\n\t\t\tif (x.status === 403) inst.emit(\"login_error\");\r\n\t\t\tfirstGroupFetch = false;\r\n\t\t\tclearAlerts();\r\n\t\t\tels.groups.html( temp.danger() );\r\n\t\t});\r\n\t}\r\n\tfunction clearAlerts() {\r\n\t\tels.groups.empty();\r\n\t}\r\n\tfunction setGroups(arr) {\r\n\t\tarr.unshift({id: \"all\", name: \"All\"});\r\n\t\tgroups = arr;\r\n\t\t\r\n\t\treturn inst;\r\n\t}\r\n\tfunction renderForm() {\r\n\t\tif (!groups) throw new Error(\"renderForm(): groups must be set before calling.\"); \r\n\t\tclearAlerts();\r\n\t\tlet g = els.groups;\r\n\t\tg.html( temp.formRow({groups: groups}) );\r\n\t\tels.checkboxes = g.find(\":checkbox\");\r\n\t\tels.toDisable = els.toDisable.add( els.checkboxes );\r\n\t\tcheckboxes.emit(\"ready\", els.checkboxes);\r\n\t\treturn inst;\r\n\t}\r\n\t\r\n\tc.retry = () => {\r\n\t\tclearAlerts();\r\n\t\tfetchGroups();\r\n\t};\r\n\tc.add.typeChange = e => {\r\n\t\tlet val = e.target.value;\r\n\t\tlet n1 = d.RANGE_COUNT_DEF[val];\r\n\t\tlet n2 = d.RANGE_COUNT_MAX[val];\r\n\t\tels.rangeCount.val(n1);\r\n\t\tels.rangeCount.attr(\"max\", n2);\r\n\t};\r\n\tc.add.countChange = e => {\r\n\t\tlet el = $(e.target);\r\n\t\tlet type = els.rangeType.val();\r\n\t\tlet max = d.RANGE_COUNT_MAX[type];\r\n\t\tlet min = parseInt(el.attr(\"min\"), 10);\r\n\t\tlet val = el.val();\r\n\t\tif (val) {\r\n\t\t\tlet num = parseInt(val, 10);\r\n\t\t\tif (num > max) {\r\n\t\t\t\tel.val(max);\r\n\t\t\t} else if (num < min) {\r\n\t\t\t\tel.val(min);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tel.val( d.RANGE_COUNT_DEF[type] );\r\n\t\t}\r\n\t};\r\n\tc.edit.typeChange = e => {\r\n\t\tlet curr = e.data;\r\n\t\tlet v = e.target.value;\r\n\t\tlet rc = els.rangeCount;\r\n\t\tlet count = parseInt(rc.val(), 10);\r\n\t\trc.attr(\"max\", d.RANGE_COUNT_MAX[v]).change();\r\n\t\t// toggle.submit( v !== curr.type || count !== curr.count );\r\n\t};\r\n\tc.edit.countChange = e => {\r\n\t\tlet curr = e.data;\r\n\t\tlet el = $(e.target);\r\n\t\tlet type = els.rangeType.val();\r\n\t\tlet max = d.RANGE_COUNT_MAX[type];\r\n\t\tlet min = parseInt(el.attr(\"min\"), 10);\r\n\t\tlet val = el.val();\r\n\t\tif (val) {\r\n\t\t\tlet num = parseInt(val, 10);\r\n\t\t\tif (num > max) {\r\n\t\t\t\tel.val(max);\r\n\t\t\t} else if (num < min) {\r\n\t\t\t\tel.val(min);\r\n\t\t\t}\r\n\t\t\t// toggle.submit(num !== curr.count || type !== curr.type);\r\n\t\t} else {\r\n\t\t\tel.val( d.RANGE_COUNT_DEF[type] );\r\n\t\t}\r\n\t};\r\n\t\r\n\tfunction setChk(checkboxes, selected) {\r\n\t\tcheckboxes\r\n\t\t\t.prop({checked: false})\r\n\t\t\t.each(function (x, l) {\r\n\t\t\t\tthis.checked = selected.indexOf( parseInt(this.value, 10) ) !== -1;\r\n\t\t\t});\r\n\t\tif (selected.indexOf('all') !== -1) {\r\n\t\t\tcheckboxes\r\n\t\t\t\t.filter(\"[value='all']\")\r\n\t\t\t\t.prop({checked: true});\r\n\t\t}\r\n\t}\r\n\tfunction setForAdd() {\r\n\t\tinst.shallow = true;\r\n\t\ttoggle.prev(true);\r\n\t\tif (els.checkboxes) {\r\n\t\t\tels.checkboxes.prop({checked: false});\r\n\t\t} else {\r\n\t\t\tcheckboxes.on(\"ready\", els => {\r\n\t\t\t\tels.prop({checked: false});\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tdataTable.removeAll();\r\n\t\tdevice.off().on(\"select\", device => {\r\n\t\t\tdataTable.addRow(device);\r\n\t\t});\r\n\t\t\r\n\t\tels.violated.prop({checked: false});\r\n\t\tels.live.prop({checked: false});\r\n\t\t\r\n\t\t/* els.rangeType\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", c.add.typeChange)\r\n\t\t\t.val(d.RANGE_TYPE)\r\n\t\t\t.change();\r\n\t\tels.rangeCount\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", c.add.countChange); */\r\n\t}\r\n\tfunction setForEdit(o) {\r\n\t\tlet m = o.map;\r\n\t\tlet devices = m.devices;\r\n\t\ttoggle.prev(false);\r\n\t\tif (els.checkboxes) {\r\n\t\t\tsetChk(els.checkboxes, m.groups);\r\n\t\t} else {\r\n\t\t\tcheckboxes.on(\"ready\", els => {\r\n\t\t\t\tsetChk(els, m.groups);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tdataTable.removeAll();\r\n\t\tif (devices) {\r\n\t\t\tObject.keys(devices).forEach( k => dataTable.addRow(devices[k]) );\r\n\t\t}\r\n\t\t\r\n\t\tdevice.off().on(\"select\", device => {\r\n\t\t\tdataTable.addRow(device);\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\tels.violated.prop({checked: m.violated});\r\n\t\tels.live.prop({checked: m.live});\r\n\t\t\r\n\t\t/* let type = o.rangeType;\r\n\t\tlet count = o.rangeCount;\r\n\t\tlet curr = {\r\n\t\t\ttype: type,\r\n\t\t\tcount: count\r\n\t\t};\r\n\t\tels.rangeType\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", curr, c.edit.typeChange)\r\n\t\t\t.val(type)\r\n\t\t\t.change();\r\n\t\tels.rangeCount\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", curr, c.edit.countChange)\r\n\t\t\t.val(count)\r\n\t\t\t.change(); */\r\n\t}\r\n\tfunction get() {\r\n\t\t// let rangeTypeVal = els.rangeType.val();\r\n\t\t// let rangeCountVal = els.rangeCount.val();\r\n\t\tlet res = {\r\n\t\t\t// rangeType: rangeTypeVal,\r\n\t\t\t// rangeCount: parseInt(rangeCountVal, 10),\r\n\t\t\t// rangeTitle: share.getRangeTitle(rangeTypeVal, rangeCountVal),\r\n\t\t\tmap: {\r\n\t\t\t\tgroups: null,\r\n\t\t\t\tdevices: dataTable.getData() || null,\r\n\t\t\t\tviolated: els.violated.prop(\"checked\"),\r\n\t\t\t\tlive: els.live.prop(\"checked\")\r\n\t\t\t}\r\n\t\t};\r\n\t\tlet groups = [];\r\n\t\tels.groups.find(\":checkbox:checked\").each((x, l) => {\r\n\t\t\tlet v = l.value;\r\n\t\t\tlet id = v === \"all\" ? v : parseInt(v, 10);\r\n\t\t\tif (id) groups.push(id);\r\n\t\t});\r\n\t\tres.map.groups = groups;\r\n\t\treturn res;\r\n\t}\r\n\tfunction close() {\r\n\t\tinst.shallow = false;\r\n\t\tuk.closeModal(ROOT);\r\n\t}\r\n\t\r\n\tinst.shallow = false;\r\n\tinst.setGroups = setGroups;\r\n\tinst.renderForm = renderForm;\r\n\tinst.fetchGroups = fetchGroups;\r\n\t\r\n\tinst.set = (o) => {\r\n\t\to ? setForEdit(o) : setForAdd();\r\n\t\treturn inst;\r\n\t};\r\n\tinst.open = () => {\r\n\t\tuk.openModal(ROOT);\r\n\t};\r\n\tinst.init = () => {\r\n\t\tels = u.getEls(ROOT);\r\n\t\tdevice.init(els.device);\r\n\t\tdataTable.init(els.table);\r\n\t\t\r\n\t\tels.prev.on( \"click\", e => {\r\n\t\t\tif (e.target.disabled) return;\r\n\t\t\tinst.emit(\"prev\");\r\n\t\t});\r\n\t\tels.groups\r\n\t\t\t.on(\"click\", \"[data-retry]\", c.retry)\r\n\t\t\t.on(\"click\", \"input:checkbox\", e => {\r\n\t\t\t\tlet chks = els.checkboxes;\r\n\t\t\t\tlet el = e.target;\r\n\t\t\t\tlet v = el.value;\r\n\t\t\t\tif (v === \"all\") {\r\n\t\t\t\t\tchks.prop({checked: el.checked});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchks.filter(\"[value='all']\").prop({checked: false});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\r\n\t\t\r\n\t\tels.submit.on(\"click\", e => {\r\n\t\t\tif (e.target.disabled) return;\r\n\t\t\ttoggle.toDisable(false);\r\n\t\t\tdataTable.toggleAll(false);\r\n\t\t\tinst.emit(\"submit\", get(), success => {\r\n\t\t\t\ttoggle.toDisable(true);\r\n\t\t\t\tdataTable.toggleAll(true);\r\n\t\t\t\tif (success) close();\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\t\r\n\twindow.w4 = () => els;\r\n\treturn inst;\r\n});"]}
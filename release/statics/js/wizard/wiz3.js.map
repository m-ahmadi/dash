{"version":3,"sources":["../../../../src/js/wizard/wiz3.js"],"names":["define","uk","conf","token","d","share","inst","u","extend","newPubSub","ROOT","temp","getTemps","els","firstGroupFetch","c","add","edit","toggle","submit","b","attr","disabled","prev","toDisable","modal","groupSucc","arr","setTimeout","stat","empty","forEach","groups","append","groupOpt","name","i","value","id","groupFail","btnParent","groupOptBtn","groupOptDanger","fetchGroups","smallSpinner","$","ajax","url","BASE","method","data","done","Groups","push","Name","ID","emit","fail","x","status","groupChange","curr","e","v","target","parseInt","groupId","typeChange","val","n1","RANGE_COUNT_DEF","n2","RANGE_COUNT_MAX","rangeCount","countChange","el","type","rangeType","max","min","num","rc","count","change","setForAdd","shallow","off","on","RANGE_TYPE","setForEdit","o","group","get","rangeTypeVal","rangeCountVal","rangeTitle","getRangeTitle","find","text","statKpis","STAT_KPIS","close","open","set","init","getEls","toDis","success"],"mappings":"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","file":"wiz3.js","sourcesContent":["define([\"core/uk\", \"core/config\", \"core/token\", \"./defaults\", \"./share\"], (uk, conf, token, d, share) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst ROOT = \"[data-root='wiz3']\";\r\n\tconst temp = u.getTemps(\"wizard/wiz3\");\r\n\t\r\n\tlet els;\r\n\tlet firstGroupFetch = true;\r\n\tlet c = { add: {}, edit: {} }; // event callbacks\r\n\tlet toggle = {\r\n\t\tsubmit(b) {\r\n\t\t\tels.submit.attr({disabled: !b});\r\n\t\t},\r\n\t\tprev(b) {\r\n\t\t\tels.prev.attr({disabled: !b});\r\n\t\t},\r\n\t\ttoDisable(b) {\r\n\t\t\tels.toDisable.attr({disabled: !b});\r\n\t\t},\r\n\t\tmodal(b) {\r\n\t\t\tuk[b ? \"openModal\" : \"closeModal\"](ROOT);\r\n\t\t}\r\n\t};\r\n\t\r\n\tfunction groupSucc(arr) {\r\n\t\tif (!els) { setTimeout(groupSucc, 1000); return; }\r\n\t\tels.stat.empty();\r\n\t\tarr.forEach(i => {\r\n\t\t\tels.groups.append( temp.groupOpt({name: i.name, value: i.id}) );\r\n\t\t});\r\n\t}\r\n\tfunction groupFail() {\r\n\t\tif (!els) { setTimeout(groupFail, 1000); return; }\r\n\t\tels.btnParent.empty().append( temp.groupOptBtn() );\r\n\t\tels.stat.empty().append( temp.groupOptDanger() );\r\n\t}\r\n\tfunction fetchGroups() {\r\n\t\tif (!firstGroupFetch) {\r\n\t\t\tels.btnParent.empty();\r\n\t\t\tels.stat.empty().append( temp.smallSpinner() );\r\n\t\t}\r\n\t\t$.ajax({\r\n\t\t\turl: conf.BASE + \"device/grouptree\" + token(),\r\n\t\t\tmethod: \"GET\",\r\n\t\t\tdata: \"parent_only=true\"\r\n\t\t})\r\n\t\t.done(d => {\r\n\t\t\tlet arr = [];\r\n\t\t\td.groups[0].Groups.forEach( i => arr.push({name: i.Name, id: i.ID}) );\r\n\t\t\tgroupSucc(arr);\r\n\t\t\tinst.emit(\"group_fetch_succ\", arr);\r\n\t\t})\r\n\t\t.fail(x => {\r\n\t\t\tif (x.status === 403) {\r\n\t\t\t\tinst.emit(\"login_error\");\r\n\t\t\t} else {\r\n\t\t\t\tinst.emit(\"group_fetch_fail\");\r\n\t\t\t}\r\n\t\t\tgroupFail();\r\n\t\t});\r\n\t\tfirstGroupFetch = false;\r\n\t}\r\n\t\r\n\tc.groupChange = e => {\r\n\t\tlet curr = e.data;\r\n\t\tlet v = e.target.value;\r\n\t\tif (curr) {\r\n\t\t\tels.submit.attr({disabled: !v || parseInt(v, 10) === curr.groupId});\r\n\t\t} else {\r\n\t\t\tels.submit.attr({disabled: v ? false : true});\r\n\t\t}\r\n\t};\r\n\tc.add.typeChange = e => {\r\n\t\tlet val = e.target.value;\r\n\t\tlet n1 = d.RANGE_COUNT_DEF[val];\r\n\t\tlet n2 = d.RANGE_COUNT_MAX[val];\r\n\t\tels.rangeCount.val(n1);\r\n\t\tels.rangeCount.attr(\"max\", n2);\r\n\t};\r\n\tc.add.countChange = e => {\r\n\t\tlet el = $(e.target);\r\n\t\tlet type = els.rangeType.val();\r\n\t\tlet max = d.RANGE_COUNT_MAX[type];\r\n\t\tlet min = parseInt(el.attr(\"min\"), 10);\r\n\t\tlet val = el.val();\r\n\t\tif (val) {\r\n\t\t\tlet num = parseInt(val, 10);\r\n\t\t\tif (num > max) {\r\n\t\t\t\tel.val(max);\r\n\t\t\t} else if (num < min) {\r\n\t\t\t\tel.val(min);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tel.val( d.RANGE_COUNT_DEF[type] );\r\n\t\t}\r\n\t};\r\n\tc.edit.typeChange = e => {\r\n\t\tlet curr = e.data;\r\n\t\tlet v = e.target.value;\r\n\t\tlet rc = els.rangeCount;\r\n\t\tlet count = parseInt(rc.val(), 10);\r\n\t\trc.attr(\"max\", d.RANGE_COUNT_MAX[v]).change();\r\n\t\ttoggle.submit( v !== curr.type || count !== curr.count );\r\n\t};\r\n\tc.edit.countChange = e => {\r\n\t\tlet curr = e.data;\r\n\t\tlet el = $(e.target);\r\n\t\tlet type = els.rangeType.val();\r\n\t\tlet max = d.RANGE_COUNT_MAX[type];\r\n\t\tlet min = parseInt(el.attr(\"min\"), 10);\r\n\t\tlet val = el.val();\r\n\t\tif (val) {\r\n\t\t\tlet num = parseInt(val, 10);\r\n\t\t\tif (num > max) {\r\n\t\t\t\tel.val(max);\r\n\t\t\t} else if (num < min) {\r\n\t\t\t\tel.val(min);\r\n\t\t\t}\r\n\t\t\ttoggle.submit(num !== curr.count || type !== curr.type);\r\n\t\t} else {\r\n\t\t\tel.val( d.RANGE_COUNT_DEF[type] );\r\n\t\t}\r\n\t};\r\n\tfunction setForAdd() {\r\n\t\tinst.shallow = true;\r\n\t\ttoggle.prev(true);\r\n\t\tels.rangeType\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", c.add.typeChange)\r\n\t\t\t.val(d.RANGE_TYPE)\r\n\t\t\t.change();\r\n\t\tels.rangeCount\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", c.add.countChange);\r\n\t\tels.groups\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", c.groupChange)\r\n\t\t\t.val(\"\")\r\n\t\t\t.change();\r\n\t}\r\n\tfunction setForEdit(o) {\r\n\t\ttoggle.prev(false);\r\n\t\tlet type = o.rangeType;\r\n\t\tlet count = o.rangeCount;\r\n\t\tlet groupId = o.group.id;\r\n\t\tlet curr = {\r\n\t\t\ttype: type,\r\n\t\t\tcount: count\r\n\t\t};\r\n\t\t\r\n\t\tels.rangeType\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", curr, c.edit.typeChange)\r\n\t\t\t.val(type)\r\n\t\t\t.change();\r\n\t\t\t\r\n\t\tels.rangeCount\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", curr, c.edit.countChange)\r\n\t\t\t.val(count)\r\n\t\t\t.change();\r\n\t\t\t\r\n\t\tels.groups\r\n\t\t\t.off(\"change\")\r\n\t\t\t.on(\"change\", {groupId: groupId}, c.groupChange)\r\n\t\t\t.val(groupId)\r\n\t\t\t.change();\r\n\t}\r\n\tfunction get() {\r\n\t\tlet rangeTypeVal = els.rangeType.val();\r\n\t\tlet rangeCountVal = els.rangeCount.val();\r\n\t\tlet groups = els.groups;\r\n\t\treturn {\r\n\t\t\trangeType: rangeTypeVal,\r\n\t\t\trangeCount: parseInt(rangeCountVal, 10),\r\n\t\t\trangeTitle: share.getRangeTitle(rangeTypeVal, rangeCountVal),\r\n\t\t\tgroup: {\r\n\t\t\t\tid: parseInt(groups.val(), 10),\r\n\t\t\t\tname: groups.find(\":selected\").text()\r\n\t\t\t},\r\n\t\t\tstatKpis: conf.STAT_KPIS\r\n\t\t};\r\n\t}\r\n\tfunction close() {\r\n\t\tinst.shallow = false;\r\n\t\ttoggle.modal(false);\r\n\t}\r\n\t\r\n\tinst.open = () => {\r\n\t\ttoggle.modal(true);\r\n\t\treturn inst;\r\n\t};\r\n\tinst.set = (o) => {\r\n\t\to ? setForEdit(o) : setForAdd();\r\n\t\treturn inst;\r\n\t};\r\n\tinst.fetchGroups = fetchGroups;\r\n\tinst.init = () => {\r\n\t\tels = u.getEls(ROOT);\r\n\t\t\r\n\t\tels.prev.on( \"click\", e => {\r\n\t\t\tif (e.target.disabled) return;\r\n\t\t\tinst.emit(\"prev\")\r\n\t\t});\r\n\t\t\r\n\t\tels.btnParent.on(\"click\", \"[data-retry]\", fetchGroups);\r\n\t\t\r\n\t\tels.submit.on(\"click\", e => {\r\n\t\t\tif (e.target.disabled) return;\r\n\t\t\tlet toDis = els.toDisable; \r\n\t\t\ttoDis.attr({disabled: true});\r\n\t\t\tinst.emit(\"submit\", get(), success => {\r\n\t\t\t\ttoDis.attr({disabled: false});\r\n\t\t\t\tif (success) close();\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\t\r\n\treturn inst;\r\n});"]}
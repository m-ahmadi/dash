{"version":3,"sources":["../../../src/js/header.js"],"names":["define","conf","token","login","inst","u","extend","newPubSub","ROOT","temp","getTemps","FORMAT","HIDE_KLASS","els","getUserInfo","userCookie","o","name","Name","username","Username","admin","Admin","unreadMsg","UnreadMassage","fetchTime","now","html","smallSpinner","$","ajax","url","BASE","method","done","data","isNum","offset","empty","timer","emit","danger","fail","ts","text","moment","format","setTimeout","adjust","user","JSON","parse","Cookies","get","Error","umsg","adonly","removeClass","unredMsg","init","getEls","on"],"mappings":"AAAAA,OAAO,CAAC,aAAD,EAAgB,YAAhB,EAA8B,OAA9B,CAAP,EAA+C,UAACC,IAAD,EAAOC,KAAP,EAAcC,KAAd,EAAwB;AACtE,KAAMC,OAAOC,EAAEC,MAAF,CAAUC,WAAV,CAAb;AACA,KAAMC,OAAO,sBAAb;AACA,KAAMC,OAAOJ,EAAEK,QAAF,CAAW,SAAX,CAAb;AACA,KAAMC,SAAS,yBAAf;AACA,KAAMC,aAAa,WAAnB;AACA,KAAIC,YAAJ;;AAEA,UAASC,WAAT,CAAqBC,UAArB,EAAiC;AAChC,MAAIC,IAAID,UAAR;AACA,SAAO;AACNE,SAAWD,EAAEE,IADP;AAENC,aAAWH,EAAEI,QAFP;AAGNC,UAAWL,EAAEM,KAHP;AAINC,cAAWP,EAAEQ;AAJP,GAAP;AAMA;AACD,UAASC,SAAT,GAAqB;AACpBZ,MAAIa,GAAJ,CAAQC,IAAR,CAAclB,KAAKmB,YAAL,EAAd;AACAC,IAAEC,IAAF,CAAO;AACNC,QAAK9B,KAAK+B,IAAL,GAAY,MAAZ,GAAqB9B,OADpB;AAEN+B,WAAQ;AAFF,GAAP,EAICC,IAJD,CAIM,gBAAQ;AACb,OAAKC,QAAQ9B,EAAE+B,KAAF,CAAQD,KAAKE,MAAb,CAAb,EAAoC;AACnCxB,QAAIa,GAAJ,CAAQY,KAAR;AACAC;AACAnC,SAAKoC,IAAL,CAAU,MAAV,EAAkBL,KAAKE,MAAvB;AACA,IAJD,MAIO;AACNxB,QAAIa,GAAJ,CAAQC,IAAR,CAAclB,KAAKgC,MAAL,EAAd;AACA;AACD,GAZD,EAaCC,IAbD,CAaM,aAAK;AACV7B,OAAIa,GAAJ,CAAQC,IAAR,CAAclB,KAAKgC,MAAL,EAAd;AACA,GAfD;AAgBA;AACD,UAASF,KAAT,CAAeI,EAAf,EAAmB;AAClB9B,MAAIa,GAAJ,CAAQkB,IAAR,CAAcC,OAAOF,EAAP,EAAWG,MAAX,CAAkBnC,MAAlB,CAAd;AACAoC,aAAWR,KAAX,EAAkB,IAAlB;AACA;;AAEDnC,MAAK4C,MAAL,GAAc,YAAM;AACnBvB;AACA,MAAIwB,OAAOnC,YAAaoC,KAAKC,KAAL,CAAYC,QAAQC,GAAR,CAAY,MAAZ,CAAZ,CAAb,CAAX;AACA,MAAI,CAACJ,IAAL,EAAW,MAAM,IAAIK,KAAJ,CAAU,iBAAV,CAAN;AACX,MAAIC,OAAON,KAAKzB,aAAhB;AACA,MAAIyB,KAAK5B,KAAT,EAAgB;AACfR,OAAI2C,MAAJ,CAAWC,WAAX,CAAuB7C,UAAvB;AACA;AACDC,MAAII,IAAJ,CAAS2B,IAAT,CAAcK,KAAKhC,IAAnB;AACA;AACA,MAAKZ,EAAE+B,KAAF,CAAQmB,IAAR,KAAiBA,OAAO,CAA7B,EAAiC;AAChC1C,OAAI6C,QAAJ,CACEd,IADF,CACOW,IADP,EAEEE,WAFF,CAEc7C,UAFd;AAGA;AACD,EAfD;AAgBAR,MAAKuD,IAAL,GAAY,YAAM;AACjB9C,QAAMR,EAAEuD,MAAF,CAASpD,IAAT,CAAN;AACAK,MAAIa,GAAJ,CAAQmC,EAAR,CAAW,OAAX,EAAoB,cAApB,EAAoCpC,SAApC;AACA,EAHD;;AAKA,QAAOrB,IAAP;AACA,CA/DD","file":"header.js","sourcesContent":["define([\"core/config\", \"core/token\", \"login\"], (conf, token, login) => {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst ROOT = \"[data-root='header']\";\r\n\tconst temp = u.getTemps(\"header/\");\r\n\tconst FORMAT = \"MMMM Do YYYY, h:mm:ss a\";\r\n\tconst HIDE_KLASS = \"uk-hidden\";\r\n\tlet els;\r\n\t\r\n\tfunction getUserInfo(userCookie) {\r\n\t\tlet o = userCookie;\r\n\t\treturn {\r\n\t\t\tname:      o.Name,\r\n\t\t\tusername:  o.Username,\r\n\t\t\tadmin:     o.Admin,\r\n\t\t\tunreadMsg: o.UnreadMassage\r\n\t\t};\r\n\t}\r\n\tfunction fetchTime() {\r\n\t\tels.now.html( temp.smallSpinner() );\r\n\t\t$.ajax({\r\n\t\t\turl: conf.BASE + \"time\" + token(),\r\n\t\t\tmethod: \"GET\"\r\n\t\t})\r\n\t\t.done(data => {\r\n\t\t\tif ( data && u.isNum(data.offset) ) {\r\n\t\t\t\tels.now.empty();\r\n\t\t\t\ttimer();\r\n\t\t\t\tinst.emit(\"time\", data.offset);\r\n\t\t\t} else {\r\n\t\t\t\tels.now.html( temp.danger() );\r\n\t\t\t}\r\n\t\t})\r\n\t\t.fail(x => {\r\n\t\t\tels.now.html( temp.danger() );\r\n\t\t});\r\n\t}\r\n\tfunction timer(ts) {\r\n\t\tels.now.text( moment(ts).format(FORMAT) );\r\n\t\tsetTimeout(timer, 1000);\r\n\t}\r\n\t\r\n\tinst.adjust = () => {\r\n\t\tfetchTime();\r\n\t\tlet user = getUserInfo( JSON.parse( Cookies.get(\"user\") ) );\r\n\t\tif (!user) throw new Error(\"No user cookie.\");\r\n\t\tlet umsg = user.UnreadMassage;\r\n\t\tif (user.admin) {\r\n\t\t\tels.adonly.removeClass(HIDE_KLASS);\r\n\t\t}\r\n\t\tels.name.text(user.name);\r\n\t\t// els.username.text(user.username);\r\n\t\tif ( u.isNum(umsg) && umsg > 0 ) {\r\n\t\t\tels.unredMsg\r\n\t\t\t\t.text(umsg)\r\n\t\t\t\t.removeClass(HIDE_KLASS);\r\n\t\t}\r\n\t};\r\n\tinst.init = () => {\r\n\t\tels = u.getEls(ROOT);\r\n\t\tels.now.on(\"click\", \"[data-retry]\", fetchTime);\r\n\t};\r\n\t\r\n\treturn inst;\r\n});"]}
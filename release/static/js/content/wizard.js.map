{"version":3,"sources":["../../../src/js/content/wizard.js"],"names":["define","conf","token","uk","colorpick","log","console","inst","u","extend","newPubSub","WIZ_1","WIZ_2","WIZ_3","WIZ_4","CONFIRM","temp","Handlebars","templates","wiz1","wiz2","wiz3","wiz4","d","TYPE","MAP","RANGE_COUNT","RANGE_TYPE","RANGE_COUNT_MAX","m","h","w","RANGE_COUNT_DEF","KEYS","data","editMode","openedModal","newEmpty","id","undefined","name","reset","order","uid","type","rangeType","rangeCount","rangeTitle","getRangeTitle","map","device","service","sensors","expand","min","radios","eq","prop","checked","selects","empty","val","trigger","set","add","off","on","find","selected","change","toAppendAlert","remove","submit","attr","disabled","units","Math","floor","random","randColor","brightness","rgb","mix","mixedrgb","x","round","join","open","str","openModal","close","closeModal","isOpen","isUndef","start","childs","edit","e","TypeError","alertMsg","msg","append","alert","message","count","s","target","value","n1","n2","el","max","parseInt","$","num","getUrl","route","BASE","initSelect2","toEnable","resKey","toClear","toDisable","toErase","key","select2","width","placeholder","ajax","method","url","dataType","delay","o","params","term","search","page","device_ids","JSON","stringify","services","error","status","emit","processResults","targetProp","res","forEach","item","push","text","results","pagination","more","total_page","cache","multiple","minimumInputLength","sensorUnit","init","randInt","toString","length","getEls","next","filter","prev","currentTarget","closest","sensorId","index","indexOf","splice","parent","each","i","l","elData","colorEl","sensorName","unit","color","spectrum","toHex","dis1","dis2","dis3","success","t","Object","keys","p","colorpicks","delBtns","enableSubmit","one","window","dool","wizard"],"mappings":"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","file":"wizard.js","sourcesContent":["define([\"config\", \"token\", \"uk\", \"./colorpick\"], (conf, token, uk, colorpick) => {\r\n\tlet log = console.log;\r\n\t\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst WIZ_1 = \"[data-root='wiz1']\";\r\n\tconst WIZ_2 = \"[data-root='wiz2']\";\r\n\tconst WIZ_3 = \"[data-root='wiz3']\";\r\n\tconst WIZ_4 = \"[data-root='wiz4']\";\r\n\tconst CONFIRM = \"[data-root='delete']\";\r\n\tconst temp = Handlebars.templates;\r\n\tlet wiz1, wiz2, wiz3, wiz4;\r\n\tconst d = { // defaults\r\n\t\tTYPE: 0,\r\n\t\tMAP: 0,\r\n\t\tRANGE_COUNT: 15,\r\n\t\tRANGE_TYPE: \"m\",\r\n\t\tRANGE_COUNT_MAX: {\r\n\t\t\tm: 10080,\r\n\t\t\th: 168,\r\n\t\t\td: 7,\r\n\t\t\tw: 1\r\n\t\t},\r\n\t\tRANGE_COUNT_DEF: {\r\n\t\t\tm: 15,\r\n\t\t\th: 6,\r\n\t\t\td: 2,\r\n\t\t\tw: 1\r\n\t\t}\r\n\t};\r\n\t\r\n\tconst KEYS = [\r\n\t\t\"device\",\r\n\t\t\"service\",\r\n\t\t\"sensors\"\r\n\t];\r\n\t\r\n\tlet data = {},\r\n\t\teditMode,\r\n\t\topenedModal;\r\n\t\r\n\tconst newEmpty = () => {\r\n\t\treturn {\r\n\t\t\tid: undefined,\r\n\t\t\tname: undefined\r\n\t\t}\r\n\t};\r\n\tfunction reset(order) {\r\n\t\torder = order ? order : 0;\r\n\t\tdata = {\r\n\t\t\tid: uid(),\r\n\t\t\ttype: d.TYPE,\r\n\t\t\trangeType: d.RANGE_TYPE,\r\n\t\t\trangeCount: d.RANGE_COUNT,\r\n\t\t\trangeTitle: getRangeTitle(this.rangeType, this.rangeCount),\r\n\t\t\tmap: d.MAP,\r\n\t\t\tdevice: newEmpty(),\r\n\t\t\tservice: newEmpty(),\r\n\t\t\tsensors: [],\r\n\t\t\torder: order,\r\n\t\t\texpand: 0,\r\n\t\t\tmin: false\r\n\t\t};\r\n\t\twiz1.radios.eq(d.TYPE).prop({checked: true});\r\n\t\twiz2.selects.empty();\r\n\t\twiz2.selects.val(null).trigger(\"change\");\r\n\t\t\r\n\t\t\r\n\t\tlet set = wiz2.rangeCount.add(wiz3.rangeCount)\r\n\t\t\r\n\t\twiz2.rangeType.off(\"change\");\r\n\t\tset.off(\"keyup\");\r\n\t\t\r\n\t\twiz2.rangeType.on(\"change\", rangeType);\r\n\t\tset.on(\"keyup\", rangeCount);\r\n\t\t\r\n\t\twiz2.rangeType.find(`option[value='${d.RANGE_TYPE}']`).prop({selected: true}).change();\r\n\t\t//wiz2.rangeCount.val(d.RANGE_COUNT);\r\n\t\t\r\n\t\twiz2.toAppendAlert.find(\".uk-alert-danger\").remove();\r\n\t\twiz2.submit.attr({disabled: true});\r\n\t\twiz2.service.attr({disabled: true});\r\n\t\twiz2.sensors.attr({disabled: true});\r\n\t\twiz2.units.empty();\r\n\t}\r\n\tfunction uid() {\r\n\t\treturn Math.floor( Math.random() * 1000 );\r\n\t}\r\n\tfunction randColor(brightness) {\r\n\t\t// Six levels of brightness from 0 to 5, 0 being the darkest\r\n\t\tvar rgb = [Math.random() * 256, Math.random() * 256, Math.random() * 256];\r\n\t\tvar mix = [brightness * 51, brightness * 51, brightness * 51]; //51 => 255/5\r\n\t\tvar mixedrgb = [rgb[0] + mix[0], rgb[1] + mix[1], rgb[2] + mix[2]].map(function (x) {\r\n\t\t\treturn Math.round(x / 2.0)\r\n\t\t})\r\n\t\treturn \"rgb(\" + mixedrgb.join(\",\") + \")\";\r\n\t}\r\n\tfunction open(str) {\r\n\t\topenedModal = str;\r\n\t\tuk.openModal(str);\r\n\t}\r\n\tfunction close() {\r\n\t\tuk.closeModal(openedModal);\r\n\t}\r\n\tfunction isOpen() {\r\n\t\treturn !u.isUndef( openedModal );\r\n\t}\r\n\tfunction start(childs) {\r\n\t\teditMode = false;\r\n\t\treset(childs);\r\n\t\topen(WIZ_1);\r\n\t}\r\n\tfunction edit(type, e) {\r\n\t\tif (!e) { throw new TypeError(\"You must provide a widget object.\") }\r\n\t\tdata = e;\r\n\t\tif (type === 0) {\r\n\t\t\topen(WIZ_2);\r\n\t\t} else if (type === 1) {\r\n\t\t\topen(WIZ_3);\r\n\t\t} else if (type === 2) {\r\n\t\t\topen(WIZ_3);\r\n\t\t} else if (type === 3) {\r\n\t\t\topen(WIZ_4);\r\n\t\t}\r\n\t}\r\n\tfunction alertMsg(w, msg) {\r\n\t\tlet set;\r\n\t\tswitch (w) {\r\n\t\t\tcase 2: set = wiz2; break;\r\n\t\t\tcase 3: set = wiz3; break;\r\n\t\t\tcase 4: set = wiz4; break;\r\n\t\t}\r\n\t\tset.toAppendAlert.append( temp.alert({message: msg}) );\r\n\t}\r\n\tfunction getRangeTitle(type, count) {\r\n\t\tlet s = \"Last \";\r\n\t\ts += count > 1 ? `${count} ` : \"\";\r\n\t\tswitch (type) {\r\n\t\t\tcase \"m\": s += \"Minute\"; break;\r\n\t\t\tcase \"h\": s += \"Hour\"; break;\r\n\t\t\tcase \"d\": s += \"Day\"; break;\r\n\t\t\tcase \"w\": s += \"Week\"; break;\r\n\t\t}\r\n\t\ts+= count > 1 ? \"s\" : \"\";\r\n\t\treturn s;\r\n\t}\r\n\tfunction rangeType(e) {\r\n\t\tconst val = e.target.value;\r\n\t\tconst n1 = d.RANGE_COUNT_DEF[val];\r\n\t\tconst n2 = d.RANGE_COUNT_MAX[val];\r\n\t\twiz2.rangeCount.val(n1);\r\n\t\twiz2.rangeCount.attr(\"max\", n2);\r\n\t}\r\n\tfunction rangeCount(e) {\r\n\t\tconst el = e.target;\r\n\t\tconst type = wiz2.rangeType.val();\r\n\t\tconst max = d.RANGE_COUNT_MAX[type];\r\n\t\tconst min = parseInt($(el).attr(\"min\"), 10);\r\n\t\tconst val = el.value;\r\n\t\tif (val) {\r\n\t\t\tlet num = parseInt(val, 10);\r\n\t\t\tif (num > max) {\r\n\t\t\t\tel.value = max;\r\n\t\t\t} else if (num < min) {\r\n\t\t\t\tel.value = min;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfunction getUrl(type) {\r\n\t\tlet route;\r\n\t\tswitch (type) {\r\n\t\t\tcase 0: route = \"device/search\"; break;\r\n\t\t\tcase 1: route = \"device/service/search\"; break;\r\n\t\t\tcase 2: route = \"device/service/kpilist\"; break;\r\n\t\t}\r\n\t\treturn conf.BASE + route;\r\n\t}\r\n\tfunction initSelect2(el, type, toEnable, resKey, toClear, toDisable, toErase) {\r\n\t\tconst key = KEYS[type];\r\n\t\tel.select2({\r\n\t\t\twidth: \"100%\",\r\n\t\t\tplaceholder: type === 0 ? \"Select a device\" :\r\n\t\t\t\t\t\t type === 1 ? \"Select a service\" :\r\n\t\t\t\t\t\t type === 2 ? \"Select sensors\" : \"\",\r\n\t\t\tajax: {\r\n\t\t\t\tmethod: type === 0 ? \"GET\" : \"POST\",\r\n\t\t\t\turl: () => { return getUrl(type) + token() },\r\n\t\t\t\tdataType: \"json\",\r\n\t\t\t\tdelay: 250,\r\n\t\t\t\tdata: params => {\r\n\t\t\t\t\tlet o = {};\r\n\t\t\t\t\tif (params.term) {\r\n\t\t\t\t\t\to.search = params.term;\r\n\t\t\t\t\t}\r\n\t\t\t\t\to.page = params.page || 1;\r\n\t\t\t\t\tif (type === 0) {\r\n\t\t\t\t\t\t// nothing\r\n\t\t\t\t\t} else if (type === 1) {\r\n\t\t\t\t\t\to.device_ids = JSON.stringify([data.device.id]);\r\n\t\t\t\t\t} else if (type === 2) {\r\n\t\t\t\t\t\to.services = JSON.stringify([data.service.id]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn o;\r\n\t\t\t\t},\r\n\t\t\t\terror: x => {\r\n\t\t\t\t\tif (x.status === 403) {\r\n\t\t\t\t\t\tel.select2(\"close\");\r\n\t\t\t\t\t\tinst.emit(\"login_error\", () => open(WIZ_2));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tprocessResults: (data, params) => {\r\n\t\t\t\t\tlet target = resKey ? data[resKey]: data;\r\n\t\t\t\t\tlet targetProp = resKey ? [\"ID\", \"Name\"] : [\"id\", \"name\"];\r\n\t\t\t\t\tlet res = [];\r\n\t\t\t\t\tparams.page = params.page || 1;\r\n\t\t\t\t\tif (target) {\r\n\t\t\t\t\t\ttarget.forEach((item) => {\r\n\t\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\tid: item[ targetProp[0] ],\r\n\t\t\t\t\t\t\t\ttext: item[ targetProp[1] ]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tresults: res,\r\n\t\t\t\t\t\tpagination: {\r\n\t\t\t\t\t\t\tmore: params.page < data.total_page\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\tcache: false\r\n\t\t\t},\r\n\t\t\tmultiple: type === 2 ? true : false,\r\n\t\t\tminimumInputLength: 0\r\n\t\t})\r\n\t\t.on(\"select2:select\", e => {\r\n\t\t\tconst selected = e.params.data;\r\n\t\t\tif (type === 2) {\r\n\t\t\t\twiz2.units.append( temp.sensorUnit({name: selected.text, id: selected.id}) );\r\n\t\t\t\tconst el = wiz2.units.find(\"[data-colorpick]:last-child\");\r\n\t\t\t\tcolorpick.init( el, randColor( u.randInt(0, 6) ) );\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tdata[key].id = parseInt(selected.id, 10);\r\n\t\t\t\tdata[key].name = selected.text;\r\n\t\t\t}\r\n\t\t\tif (toEnable) {\r\n\t\t\t\ttoEnable.attr({disabled: false});\r\n\t\t\t}\r\n\t\t\tif (toClear) {\r\n\t\t\t\ttoClear.val(null).trigger(\"change\");\r\n\t\t\t\ttoDisable.attr({disabled: true});\r\n\t\t\t\ttoErase.empty();\r\n\t\t\t}\r\n\t\t})\r\n\t\t.on(\"change\", () => {\r\n\t\t\tif (!type === 2) {\r\n\t\t\t\tdata[key] = newEmpty();\r\n\t\t\t}\r\n\t\t})\r\n\t\t.on(\"select2:unselect\", e => {\r\n\t\t\tif (type === 2) {\r\n\t\t\t\tconst id = e.params.data.id.toString();\r\n\t\t\t\twiz2.units.find(`[data-sensor-id=${id}]`).remove();\r\n\t\t\t\tif (!el.val().length) {\r\n\t\t\t\t\twiz2.submit.attr({disabled: true});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tfunction init() {\r\n\t\twiz1 = u.getEls(WIZ_1);\r\n\t\twiz2 = u.getEls(WIZ_2);\r\n\t\twiz3 = u.getEls(WIZ_3);\r\n\t\twiz4 = u.getEls(WIZ_4);\r\n\t\t\r\n\t\t\r\n\t\tconst toClear = wiz2.service.add(wiz2.sensors);\r\n\t\tconst toDisable = wiz2.sensors.add(wiz2.submit);\r\n\t\tconst toErase = wiz2.units;\r\n\t\tinitSelect2(wiz2.device, 0, wiz2.service, \"devices\", toClear, toDisable, toErase);\r\n\t\tinitSelect2(wiz2.service, 1, wiz2.sensors, \"service\", wiz2.sensors, wiz2.submit, toErase);\r\n\t\tinitSelect2(wiz2.sensors, 2, wiz2.submit, \"\");\r\n\t\treset();\r\n\t\t\r\n\t\twiz1.next.on(\"click\", () => {\r\n\t\t\tconst checked = wiz1.radios.filter(\":checked\").val();\r\n\t\t\tconst type = parseInt(checked, 10);\r\n\t\t\tdata.type = type;\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 0: open(WIZ_2); break;\r\n\t\t\t\tcase 1: open(WIZ_3); break;\r\n\t\t\t\tcase 2: open(WIZ_3); break;\r\n\t\t\t\tcase 3: open(WIZ_4); break; \r\n\t\t\t}\r\n\t\t});\r\n\t\twiz2.prev.on( \"click\", () => open(WIZ_1) );\r\n\t\twiz3.prev.on( \"click\", () => open(WIZ_1) );\r\n\t\twiz4.prev.on( \"click\", () => open(WIZ_1) );\r\n\t\t\r\n\t\t\r\n\t\twiz2.selects.on(\"click\", () => {\r\n\t\t\twiz2.submit.attr({disabled: true});\r\n\t\t});\r\n\t\twiz2.units.on(\"click\", \"[data-delete-sensor]\", e => {\r\n\t\t\tconst el = $(e.currentTarget);\r\n\t\t\tconst id = el.closest(\"[data-sensor-id]\").data().sensorId.toString();\r\n\t\t\tconst sensors = wiz2.sensors;\r\n\t\t\tconst val = sensors.val();\r\n\t\t\tconst index = val.indexOf(id);\r\n\t\t\tval.splice(index, 1);\r\n\t\t\tsensors.val(val).trigger(\"change\");\r\n\t\t\tel.parent().parent().remove();\r\n\t\t\tif (!sensors.val().length) {\r\n\t\t\t\twiz2.submit.attr({disabled: true});\r\n\t\t\t}\r\n\t\t});\r\n\t\twiz2.submit.on(\"click\", () => {\r\n\t\t\tdata.rangeType = wiz2.rangeType.val();\r\n\t\t\tdata.rangeCount = parseInt( wiz2.rangeCount.val() );\r\n\t\t\tdata.rangeTitle = getRangeTitle(wiz2.rangeType.val(), wiz2.rangeCount.val());\r\n\t\t\tdata.sensors = {};\r\n\t\t\twiz2.units.find(\"[data-sensor-id]\").each((i, l) => {\r\n\t\t\t\tlet el = $(l);\r\n\t\t\t\tlet elData = el.data();\r\n\t\t\t\tlet sensorId = elData.sensorId;\r\n\t\t\t\tlet colorEl = el.find(\"[data-colorpick]\");\r\n\t\t\t\tdata.sensors[sensorId] = {\r\n\t\t\t\t\tid: sensorId,\r\n\t\t\t\t\tname: elData.sensorName,\r\n\t\t\t\t\tunit: el.find(\"[data-select]\").val(),\r\n\t\t\t\t\tcolor: el.find(\"[data-colorpick]\").spectrum(\"get\").toHex()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tlog(data);\r\n\t\t\t\r\n\t\t\tlet dis1 = wiz2.toDisable.attr({disabled: true});\r\n\t\t\tlet dis2 = wiz2.units.find(\"[data-todisable]\").attr({disabled: true});\r\n\t\t\tlet dis3 = wiz2.units.find(\"[data-colorpick]\").spectrum(\"disable\");\r\n\t\t\tinst.emit(`submit:${editMode ? \"edit\" : \"create\"}`, data, success => {\r\n\t\t\t\tdis1.attr({disabled: false});\r\n\t\t\t\tif (success) {\r\n\t\t\t\t\tdis3.spectrum(\"destroy\");\r\n\t\t\t\t\tclose();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdis2.attr({disabled: false});\r\n\t\t\t\t\tdis3.spectrum(\"enable\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\twiz3.submit.on(\"click\", () => {\r\n\t\t\tconst t = data.type;\r\n\t\t\tif (t === 1) {\r\n\t\t\t\t// sensor_violation_ratio\r\n\t\t\t} else if (t === 2) {\r\n\t\t\t\t// sensor_violation_stat\r\n\t\t\t}\r\n\t\t});\r\n\t\twiz4.submit.on(\"click\", () => {\r\n\t\t\tinst.emit(data.type);\r\n\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\tfunction edit(o) {\r\n\t\teditMode = true;\r\n\t\tlet t = o.type;\r\n\t\treset();\r\n\t\tdata = o;\r\n\t\tif (t === 0) {\r\n\t\t\topen(WIZ_2);\r\n\t\t\twiz1.radios.eq(o.type).prop({checked: true});\r\n\t\t\twiz2.rangeType.val(o.rangeType);\r\n\t\t\twiz2.rangeCount.val(o.rangeCount);\r\n\t\t\twiz2.rangeCount.attr(\"max\", d.RANGE_COUNT_MAX[o.rangeType]);\r\n\t\t\t\r\n\t\t\twiz2.device.append( $(\"<option></option>\").val(o.device.id).text(o.device.name) ).trigger(\"change\");\r\n\t\t\twiz2.service.attr({disabled: false}).append( $(\"<option></option>\").val(o.service.id).text(o.service.name) ).trigger(\"change\");\r\n\t\t\twiz2.sensors.attr({disabled: false});\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tObject.keys(o.sensors).forEach(i => {\r\n\t\t\t\tlet p = o.sensors[i];\r\n\t\t\t// NOT_WORKIN\twiz2.sensors.append( $(\"<option></option>\").val(p.id).text(p.name) ).trigger(\"change\");\r\n\t\t\t\twiz2.units.append( temp.sensorUnit({name: p.name, id: p.id}) );\r\n\t\t\t\tlet el = wiz2.units.find(\"[data-colorpick]:last-child\");\r\n\t\t\t\tcolorpick.init( el, \"#\"+p.color, () => wiz2.submit.attr({disabled: false}) );\r\n\t\t\t\twiz2.units.find(`[data-select] [value='${p.unit}']`).prop({checked: true});\r\n\t\t\t});\r\n\t\t\tlet colorpicks = wiz2.units.find(\"[data-select]\");\r\n\t\t\tlet delBtns = wiz2.units.find(\"[data-delete-sensor]\");\r\n\t\t\tlet enableSubmit = e => {\r\n\t\t\t\twiz2.submit.attr({disabled: false})\r\n\t\t\t\tcolorpicks.off(\"change\", enableSubmit);\r\n\t\t\t\twiz2.rangeType.off(\"change\", enableSubmit);\r\n\t\t\t\twiz2.rangeCount.off(\"change\", enableSubmit);\r\n\t\t\t\tdelBtns.off(\"click\", enableSubmit);\r\n\t\t\t};\r\n\t\t\tdelBtns.one(\"click\", enableSubmit);\r\n\t\t\tcolorpicks.one(\"change\", enableSubmit);\r\n\t\t\twiz2.rangeType.one(\"change\", enableSubmit);\r\n\t\t\twiz2.rangeCount.one(\"change\", enableSubmit);\r\n\t\t\t\r\n\t\t} else if (t === 1) {\r\n\t\t\r\n\t\t} else if (t === 2) {\r\n\t\t\r\n\t\t} else if (t === 3) {\r\n\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tinst.alertMsg = alertMsg;\r\n\tinst.init = init;\r\n\tinst.start = start;\r\n\tinst.edit = edit;\r\n\tinst.close = close;\r\n\tinst.isOpen = isOpen;\r\n\t\r\n\twindow.dool = () => {return data};\r\n\twindow.wizard = inst;\r\n\treturn inst;\r\n});"]}